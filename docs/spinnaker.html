<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Daniel Hinojosa">
<title>Spinnaker</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>Spinnaker</h1>
<div class="details">
<span id="author" class="author">Daniel Hinojosa</span><br>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_before_we_begin">Before we begin</a></li>
<li><a href="#_continuous_integration_and_delivery">Continuous Integration and Delivery</a>
<ul class="sectlevel2">
<li><a href="#_continuous_integration">Continuous Integration</a></li>
<li><a href="#_extending_ci_with_spinnaker">Extending CI with Spinnaker</a></li>
<li><a href="#_continuous_integration_2">Continuous Integration</a></li>
<li><a href="#_why_continuous_integration">Why Continuous Integration?</a></li>
<li><a href="#_purpose_of_a_ci_server">Purpose of a CI Server</a></li>
<li><a href="#_how_does_ci_improve_software_quality">How does CI Improve Software Quality</a></li>
<li><a href="#_provide_value_to_the_end_user_faster">Provide Value to the End User Faster</a></li>
<li><a href="#_empowering_teams">Empowering Teams</a></li>
<li><a href="#_reducing_errors">Reducing Errors</a></li>
<li><a href="#_lowers_stress">Lowers Stress</a></li>
<li><a href="#_deployment_flexibility">Deployment Flexibility</a></li>
<li><a href="#_practice_makes_perfect">Practice Makes Perfect</a></li>
<li><a href="#_will_it_happen_overnight">Will it happen overnight?</a></li>
<li><a href="#_how_does_ci_help_release_on_time">How does CI help release on time?</a></li>
<li><a href="#_future_is_here">Future is Here</a></li>
</ul>
</li>
<li><a href="#_overview">Overview</a>
<ul class="sectlevel2">
<li><a href="#_what_is_spinnaker">What is Spinnaker?</a></li>
<li><a href="#_definitions">Definitions</a></li>
<li><a href="#_cluster_anatomy">Cluster Anatomy</a></li>
<li><a href="#_pipelines">Pipelines</a></li>
<li><a href="#_cloud_providers">Cloud Providers</a></li>
</ul>
</li>
<li><a href="#_preliminaries">Preliminaries</a>
<ul class="sectlevel2">
<li><a href="#_a_typical_install_for_administrators_of_spinnaker">A typical install for administrators of Spinnaker</a></li>
<li><a href="#_install_kubectl">Install <code>kubectl</code></a></li>
<li><a href="#_install_awscli">Install <code>awscli</code></a></li>
<li><a href="#_install_hal">Install <code>hal</code></a></li>
<li><a href="#_configure_your_aws_cli_credentials">Configure Your AWS CLI Credentials</a></li>
<li><a href="#_install_eksctl_for_macosx">Install <code>eksctl</code> for MacOSX</a></li>
<li><a href="#_install_eksctl_for_linux">Install <code>eksctl</code> for Linux</a></li>
<li><a href="#_install_terraform">Install Terraform</a></li>
<li><a href="#_install_helm">Install Helm</a></li>
</ul>
</li>
<li><a href="#_installing_in_aws_eks">Installing in AWS EKS</a>
<ul class="sectlevel2">
<li><a href="#_system_requirements">System Requirements</a></li>
<li><a href="#_installing_eks_on_amazon">Installing EKS on Amazon</a></li>
<li><a href="#_update_your_kubeconfig_file">Update your <code>kubeconfig</code> file</a></li>
<li><a href="#_change_context_to_use_kubernetes_on_eks">Change Context to Use Kubernetes on EKS</a></li>
<li><a href="#_halyard">Halyard</a></li>
<li><a href="#_deploy_spinnaker">Deploy Spinnaker</a></li>
<li><a href="#_connect_to_spinnaker_ui">Connect to Spinnaker UI</a></li>
</ul>
</li>
<li><a href="#_spinnaker_architecture">Spinnaker Architecture</a>
<ul class="sectlevel2">
<li><a href="#_describe_the_services">Describe the Services</a></li>
<li><a href="#_debugging">Debugging</a></li>
</ul>
</li>
<li><a href="#_deploying_microservices">Deploying Microservices</a>
<ul class="sectlevel2">
<li><a href="#_the_process_2">The Process</a></li>
<li><a href="#_the_steps">The Steps</a></li>
<li><a href="#_create_an_application">Create an Application</a></li>
<li><a href="#_editing_the_configuration">Editing the Configuration</a></li>
<li><a href="#_editing_notifications">Editing Notifications</a></li>
<li><a href="#_enabling_features_in_spinnaker">Enabling Features in Spinnaker</a></li>
<li><a href="#_custom_links">Custom Links</a></li>
<li><a href="#_traffic_guards">Traffic Guards</a></li>
<li><a href="#_custom_banners_and_deleting_the_application">Custom Banners and Deleting the Application</a></li>
<li><a href="#_define_the_infrastructure_the_service_will_run">Define the Infrastructure the Service will run</a></li>
<li><a href="#_pipelines_2">Pipelines</a></li>
<li><a href="#_create_a_pipeline">Create a Pipeline</a></li>
<li><a href="#_configuration_stage">Configuration Stage</a></li>
<li><a href="#_adding_stages">Adding Stages</a></li>
<li><a href="#_manually_run_your_pipeline">Manually Run your Pipeline</a></li>
<li><a href="#_deleting_a_pipeline">Deleting a Pipeline</a></li>
</ul>
</li>
<li><a href="#_artifacts">Artifacts</a>
<ul class="sectlevel2">
<li><a href="#_artifacts_in_spinnaker">Artifacts in Spinnaker</a></li>
<li><a href="#_artifact_frustration">Artifact Frustration</a></li>
<li><a href="#_what_is_the_address_of_our_artifacts">What is the "address" of our Artifacts?</a></li>
<li><a href="#_artifact_decoration">Artifact Decoration</a></li>
<li><a href="#_artifact_format">Artifact Format</a></li>
<li><a href="#_spinnaker_artifact_fields">Spinnaker Artifact Fields</a></li>
<li><a href="#_expected_artifacts">Expected Artifacts</a></li>
<li><a href="#_expected_and_bound_artifact">Expected and Bound Artifact</a></li>
<li><a href="#_matched_artifacts">Matched Artifacts</a></li>
<li><a href="#_prior_execution_and_default_artifacts">Prior execution and Default Artifacts</a></li>
<li><a href="#_review_of_artifacts">Review of Artifacts</a></li>
<li><a href="#_artifacts_in_pipelines">Artifacts in Pipelines</a></li>
<li><a href="#_triggers">Triggers</a></li>
<li><a href="#_find_artifact_from_execution">Find Artifact from Execution</a></li>
<li><a href="#_artifacts_passed_between_pipelines">Artifacts Passed between Pipelines</a></li>
<li><a href="#_stages_that_produce_artifacts">Stages that Produce Artifacts</a></li>
<li><a href="#_various_types_of_artifacts">Various Types of Artifacts</a></li>
</ul>
</li>
<li><a href="#_linking_spinnaker_to_github">Linking Spinnaker to Github</a>
<ul class="sectlevel2">
<li><a href="#_creating_a_token">Creating a token</a></li>
<li><a href="#_copying_the_token">Copying the token</a></li>
<li><a href="#_setting_up_the_token_in_spinnaker">Setting up the token in Spinnaker</a></li>
<li><a href="#_installing_your_github_connection">Installing your Github connection</a></li>
<li><a href="#_deploy_to_spinnaker">Deploy to Spinnaker</a></li>
</ul>
</li>
<li><a href="#_lab_deploying_eks_microservices">Lab: Deploying EKS Microservices</a>
<ul class="sectlevel2">
<li><a href="#_preliminary">Preliminary</a></li>
<li><a href="#_the_instructor_is_your_administrator">The instructor is your administrator!</a></li>
<li><a href="#_forking_a_repository">Forking A Repository</a></li>
<li><a href="#_editing_your_manifest">Editing your manifest</a></li>
<li><a href="#_setting_up_a_jenkins_job">Setting up a Jenkins job</a></li>
<li><a href="#_setting_up_a_spinnaker_application">Setting up a Spinnaker Application</a></li>
<li><a href="#_creating_a_pipeline">Creating a Pipeline</a></li>
<li><a href="#_github_expected_artifact">Github Expected Artifact</a></li>
<li><a href="#_setting_up_the_github_expected_artifact">Setting up the Github Expected Artifact</a></li>
<li><a href="#_docker_registry_artifact">Docker Registry Artifact</a></li>
<li><a href="#_adding_a_docker_registry_container_trigger">Adding a Docker Registry Container Trigger</a></li>
<li><a href="#_adding_a_notification">Adding a Notification</a></li>
<li><a href="#_save_changes">Save Changes</a></li>
<li><a href="#_adding_a_deploy_stage">Adding a Deploy Stage</a></li>
<li><a href="#_deploying_to_staging">Deploying to Staging</a></li>
<li><a href="#_deploying_to_production">Deploying to Production</a></li>
<li><a href="#_creating_a_pipeline_2">Creating a Pipeline</a></li>
<li><a href="#_production_trigger">Production Trigger</a></li>
<li><a href="#_adding_a_deploy_to_prod_stage">Adding a Deploy to Prod Stage</a></li>
<li><a href="#_put_it_all_in_motion">Put it all in motion</a></li>
<li><a href="#_bonus_place_a_manual_approve_in_stage">Bonus: Place a manual approve in stage</a></li>
<li><a href="#_discover_your_space">Discover your space</a></li>
<li><a href="#_things_to_discuss">Things to discuss</a></li>
</ul>
</li>
<li><a href="#_expressions">Expressions</a>
<ul class="sectlevel2">
<li><a href="#_what_are_expressions">What are expressions?</a></li>
<li><a href="#_string_interpolation">String interpolation</a></li>
<li><a href="#_where_can_expressions_be_used">Where can Expressions be used?</a></li>
<li><a href="#_when_are_they_evaluated">When are they evaluated</a></li>
<li><a href="#_helper_functions">Helper Functions</a></li>
<li><a href="#_finding_helper_functions">Finding Helper Functions</a></li>
<li><a href="#_helper_properties">Helper Properties</a></li>
<li><a href="#_getting_help_with_helper_properties">Getting Help with Helper Properties</a></li>
<li><a href="#_context_values">Context Values</a></li>
<li><a href="#_finding_context_values">Finding Context Values</a></li>
<li><a href="#_testing_pipeline_executions">Testing Pipeline Executions</a></li>
</ul>
</li>
<li><a href="#_baking">Baking</a>
<ul class="sectlevel2">
<li><a href="#_reminder_on_helm_templates">Reminder on Helm Templates</a></li>
<li><a href="#_helm_charts_offers_a_lot">Helm Charts offers a lot</a></li>
<li><a href="#_intentions">Intentions</a></li>
<li><a href="#_configure_artifact_support_in_hal">Configure Artifact support in Hal</a></li>
<li><a href="#_create_a_bake_manifest_stage">Create a Bake Manifest Stage</a></li>
<li><a href="#_configure_the_bake_manifest_stage">Configure the Bake Manifest Stage</a></li>
<li><a href="#_helm_charts_and_namespace">Helm Charts and Namespace</a></li>
<li><a href="#_producing_baked_artifacts">Producing Baked Artifacts</a></li>
<li><a href="#_configure_downstream_deployment">Configure Downstream Deployment</a></li>
</ul>
</li>
<li><a href="#_lab_deploying_helm_microservices">Lab: Deploying Helm Microservices</a>
<ul class="sectlevel2">
<li><a href="#_configuration">Configuration</a></li>
<li><a href="#_bake_a_manifest">Bake a Manifest</a></li>
<li><a href="#_create_a_deploy_stage">Create a Deploy Stage</a></li>
<li><a href="#_put_it_all_in_motion_2">Put it all in motion</a></li>
<li><a href="#_things_to_discuss_2">Things to discuss</a></li>
</ul>
</li>
<li><a href="#_rollbacks">Rollbacks</a>
<ul class="sectlevel2">
<li><a href="#_automatic_rollbacks">Automatic Rollbacks</a></li>
<li><a href="#_viewing_the_rollbacks">Viewing the Rollbacks</a></li>
<li><a href="#_ad_hoc_rollbacks">Ad Hoc Rollbacks</a></li>
<li><a href="#_automated_rollbacks">Automated Rollbacks</a></li>
<li><a href="#_parameterized_rollbacks">Parameterized Rollbacks</a></li>
<li><a href="#_versioning_artifacts">Versioning Artifacts</a></li>
</ul>
</li>
<li><a href="#_scaling">Scaling</a></li>
<li><a href="#_rollout_stratagies">Rollout Stratagies</a>
<ul class="sectlevel2">
<li><a href="#_configuration_options">Configuration Options</a></li>
<li><a href="#_strategies">Strategies</a></li>
</ul>
</li>
<li><a href="#_restrict_execution">Restrict Execution</a>
<ul class="sectlevel2">
<li><a href="#_execution_windows">Execution Windows</a></li>
<li><a href="#_manual_judgement">Manual Judgement</a></li>
<li><a href="#_notifications_with_manual_judgment">Notifications with Manual Judgment</a></li>
<li><a href="#_waiting_for_approval">Waiting for Approval</a></li>
<li><a href="#_changing_pipeline_on_selected_judgment">Changing Pipeline on Selected Judgment</a></li>
</ul>
</li>
<li><a href="#_canary_deployment">Canary Deployment</a>
<ul class="sectlevel2">
<li><a href="#_what_is_it">What is it?</a></li>
<li><a href="#_prerequisites">Prerequisites</a></li>
<li><a href="#_process">Process</a></li>
<li><a href="#_enable_canary">Enable Canary</a></li>
<li><a href="#_setting_up_canary_analysis">Setting up Canary Analysis</a></li>
<li><a href="#_setting_up_the_scope">Setting up the Scope</a></li>
<li><a href="#_setting_up_the_canary_judge">Setting up the canary judge</a></li>
<li><a href="#_identify_your_metrics_provider">Identify your metrics provider</a></li>
<li><a href="#_provide_a_default_metrics_account">Provide a default metrics account</a></li>
<li><a href="#_provide_the_default_storage_account">Provide the default storage account</a></li>
<li><a href="#_setting_up_prometheus">Setting up Prometheus</a></li>
<li><a href="#_manage_or_view_prometheus_account_for_canary">Manage or View Prometheus Account for Canary</a></li>
<li><a href="#_create_a_canary_configuration">Create a Canary Configuration</a></li>
<li><a href="#_what_you_will_be_adding_into_a_canary_configuration">What you will be adding into a Canary Configuration</a></li>
<li><a href="#_enabling_canary_at_the_user_level">Enabling Canary at the User Level</a></li>
<li><a href="#_create_your_canary_configuration">Create your Canary Configuration</a></li>
<li><a href="#_steps_for_canary_configuration_support">Steps for Canary Configuration Support</a></li>
<li><a href="#_create_metrics">Create Metrics</a></li>
<li><a href="#_editing_a_configuration">Editing a Configuration</a></li>
</ul>
</li>
<li><a href="#_prometheus">Prometheus</a>
<ul class="sectlevel2">
<li><a href="#_prometheus_setup_in_kubernetes">Prometheus setup in Kubernetes</a></li>
<li><a href="#_setup_for_prometheus">Setup for Prometheus</a></li>
<li><a href="#_create_a_service_monitor">Create a Service Monitor</a></li>
<li><a href="#_create_a_nodeport_or_loadbalancer">Create a <code>NodePort</code> or <code>LoadBalancer</code></a></li>
</ul>
</li>
<li><a href="#_lab_advanced_features">Lab: Advanced Features</a>
<ul class="sectlevel2">
<li><a href="#_discovering_prometheus">Discovering Prometheus</a></li>
<li><a href="#_view_the_metrics_of_your_microservice">View the metrics of your microservice</a></li>
<li><a href="#_create_an_application_2">Create an Application</a></li>
<li><a href="#_create_canary_configs">Create Canary Configs</a></li>
<li><a href="#_add_a_metric">Add a Metric</a></li>
<li><a href="#_configuration_of_the_metric">Configuration of the Metric</a></li>
<li><a href="#_scoring">Scoring</a></li>
<li><a href="#_creating_a_pipeline_3">Creating a Pipeline</a></li>
<li><a href="#_create_deploy_manifest_stage">Create Deploy Manifest Stage</a></li>
<li><a href="#_find_baseline">Find Baseline</a></li>
<li><a href="#_deploy_baseline">Deploy Baseline</a></li>
<li><a href="#_perform_a_canary_analysis">Perform a Canary Analysis</a></li>
<li><a href="#_delete_tokens_from_github">Delete tokens from Github</a></li>
<li><a href="#_things_to_discuss_3">Things to discuss</a></li>
</ul>
</li>
<li><a href="#_conclusion">Conclusion</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_before_we_begin">Before we begin</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please back up important files, you will be using your personal machine and some of the commands include <code>rm</code>. Even the best of us a susceptible to catastrophe.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_continuous_integration_and_delivery">Continuous Integration and Delivery</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_continuous_integration">Continuous Integration</h3>
<div class="ulist">
<ul>
<li>
<p>Taking code and integrating and testing with every check in!</p>
</li>
<li>
<p>Employs Continuous Integration (CI) Server</p>
<div class="ulist">
<ul>
<li>
<p>Jenkins</p>
</li>
<li>
<p>Bamboo</p>
</li>
<li>
<p>Cruise Control</p>
</li>
<li>
<p>Travis</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_extending_ci_with_spinnaker">Extending CI with Spinnaker</h3>
<div class="ulist">
<ul>
<li>
<p>Spinnaker takes content created in CI and deploys to staging and production</p>
</li>
<li>
<p>Jenkins could do that to a point:</p>
<div class="ulist">
<ul>
<li>
<p>It does not manage multiple servers too well</p>
</li>
<li>
<p>Jenkins (not JenkinsX) doesn&#8217;t work that well with Kubernetes</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_continuous_integration_2">Continuous Integration</h3>
<div class="ulist">
<ul>
<li>
<p>Tool that monitors version control of changes</p>
</li>
<li>
<p>When a change is detected, the tool will automatically</p>
<div class="ulist">
<ul>
<li>
<p>compile</p>
</li>
<li>
<p>test</p>
</li>
<li>
<p>report</p>
</li>
</ul>
</div>
</li>
<li>
<p>Overtime reports on the overall code quality of your project</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_why_continuous_integration">Why Continuous Integration?</h3>
<div class="ulist">
<ul>
<li>
<p>Confidence that a release will perform</p>
</li>
<li>
<p>Fully automated testing</p>
</li>
<li>
<p>Ability to have a "one click" deploy</p>
</li>
<li>
<p>Repeated and reliable</p>
</li>
<li>
<p>Enhances Collaboration Among Developers</p>
<div class="ulist">
<ul>
<li>
<p>Builds are no longer secret</p>
</li>
<li>
<p>No longer require the use of deployment expert</p>
</li>
</ul>
</div>
</li>
<li>
<p>Manual building is fairly stupid</p>
</li>
<li>
<p>Process seen in action! You know if it works or doesn&#8217;t</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_purpose_of_a_ci_server">Purpose of a CI Server</h3>
<div class="ulist">
<ul>
<li>
<p>Configured to watch your version control system</p>
</li>
<li>
<p>Check out or update your source code every time a change is made</p>
</li>
<li>
<p>Run the automated build process</p>
</li>
<li>
<p>Store the binaries where they are accessible to the whole team</p>
</li>
<li>
<p>Reducing risk by providing faster feedback</p>
</li>
<li>
<p>Identify and fix integration and regression issues faster</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_ci_improve_software_quality">How does CI Improve Software Quality</h3>
<div class="ulist">
<ul>
<li>
<p>Everyone has information on the build at every single moment</p>
</li>
<li>
<p>Developers are aware of the constant change in their project</p>
</li>
<li>
<p>Notifications to all Developers when the build fails</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_provide_value_to_the_end_user_faster">Provide Value to the End User Faster</h3>
<div class="ulist">
<ul>
<li>
<p>Ensures that software is build, tested, and maintained regularly</p>
</li>
<li>
<p>There is always a deployment of some kind</p>
</li>
<li>
<p>Deployments are no longer magical mystery events that happen every month</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_empowering_teams">Empowering Teams</h3>
<div class="ulist">
<ul>
<li>
<p>Continuous Integration can deploy onto the servers themselves.</p>
</li>
<li>
<p>Power to real time view results</p>
</li>
<li>
<p>There will be no longer the uber-operations-specialist</p>
</li>
<li>
<p>Expand the role of the developer include operations.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_reducing_errors">Reducing Errors</h3>
<div class="ulist">
<ul>
<li>
<p>Ensures the correct version, configuration, database schema, etc. are applied the same way every time through automation</p>
</li>
<li>
<p>Staging areas are equivalent to production areas</p>
</li>
<li>
<p>Less surprises.</p>
</li>
<li>
<p>No more hidden configuration that we don’t know about at production time</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_lowers_stress">Lowers Stress</h3>
<div class="ulist">
<ul>
<li>
<p>A Release becomes commonplace without the typical stress</p>
</li>
<li>
<p>No weekend battles</p>
</li>
<li>
<p>Less embarrassing releases</p>
</li>
<li>
<p>Rollback versions easily to a well known build</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_deployment_flexibility">Deployment Flexibility</h3>
<div class="ulist">
<ul>
<li>
<p>Instantiate a new environment or configuration by making a few changes to the automated delivery system.</p>
</li>
<li>
<p>Create multiple version of environments</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_practice_makes_perfect">Practice Makes Perfect</h3>
<div class="ulist">
<ul>
<li>
<p>Final deployment into production is being rehearsed every single time the software is deployed to any target environments.</p>
</li>
<li>
<p>Overtime deployment becomes standard practice</p>
</li>
<li>
<p>Check in frequently</p>
</li>
<li>
<p>Don’t check in broken code</p>
</li>
<li>
<p>Don’t check in untested code</p>
</li>
<li>
<p>Don’t check in when the build is broken</p>
</li>
<li>
<p>Don’t go home after checking in until the system builds</p>
</li>
<li>
<p>Every Check in is a potential release!</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_will_it_happen_overnight">Will it happen overnight?</h3>
<div class="ulist">
<ul>
<li>
<p>It will take time for all those invested</p>
</li>
<li>
<p>Testing will have to be commonplace</p>
</li>
<li>
<p>Commitments in code will have to be small</p>
</li>
<li>
<p>Behaviors and rituals will need to change</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_ci_help_release_on_time">How does CI help release on time?</h3>
<div class="ulist">
<ul>
<li>
<p>Automation, Automation, Automation, Automation</p>
</li>
<li>
<p>Humans are slow, why not let computers do the work?</p>
</li>
<li>
<p>Problems no longer are debt: If anything fails it must be fixed immediately</p>
</li>
<li>
<p>Bugs, along with testing, are squashed oftentimes permanently!</p>
</li>
<li>
<p>Lessens the fear of "integration hell"</p>
</li>
<li>
<p>Lessens the fear of production deployment!</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_future_is_here">Future is Here</h3>
<div class="ulist">
<ul>
<li>
<p>Spinnaker, Jenkins, and Kubernetes allows for IaC (Infrastructure as Code)</p>
</li>
<li>
<p>Continuous Integration is committed as code, using <code>Jenkinsfile</code></p>
</li>
<li>
<p>Kuberenetes <code>replicaSet</code>, <code>deployment</code>, <code>ingress</code>, etc are all <code>yaml</code> files</p>
</li>
<li>
<p>Spinnaker can use these files to deploy fleet of systems</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_spinnaker">What is Spinnaker?</h3>
<div class="ulist">
<ul>
<li>
<p>Open Source, Multicloud Platform</p>
</li>
<li>
<p>Release Software at high velocity and confidence</p>
</li>
<li>
<p>Extends where Jenkins CI leaves off</p>
</li>
<li>
<p>Manages Staging and Deployment</p>
</li>
<li>
<p>Makes use of containers</p>
</li>
<li>
<p>Provides Baking Ability and Canary Ability</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_definitions">Definitions</h3>
<div class="sect3">
<h4 id="_applications">Applications</h4>
<div class="ulist">
<ul>
<li>
<p>Represents the service which you are going to deploy using Spinnaker</p>
</li>
<li>
<p>It is the center of your universe in regards to your application</p>
</li>
<li>
<p>Contains all configuration for that service, and all the infrastructure on which it will run</p>
</li>
<li>
<p>You will typically create a different application for each service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Firewalls</p>
</li>
<li>
<p>Load Balancers</p>
</li>
<li>
<p>Clusters of Services or Deployments</p>
</li>
<li>
<p>Server Groups</p>
</li>
<li>
<p>Canary Configurations</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_clusters">Clusters</h4>
<div class="ulist">
<ul>
<li>
<p>Logical Groups of Server Groups</p>
</li>
<li>
<p>Does not map to a Kubernetes Cluster</p>
</li>
<li>
<p>It <em>does</em> map to a Kubernetes <em>Deployment</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Source: <a href="https://www.spinnaker.io/reference/providers/kubernetes/#cluster" class="bare">https://www.spinnaker.io/reference/providers/kubernetes/#cluster</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_server_group">Server Group</h4>
<div class="ulist">
<ul>
<li>
<p>A base resource</p>
<div class="ulist">
<ul>
<li>
<p>Identifies the <em>Deployable Artifact</em>:</p>
<div class="ulist">
<ul>
<li>
<p>VM Image</p>
</li>
<li>
<p>Docker Image</p>
</li>
<li>
<p>Source Location</p>
</li>
</ul>
</div>
</li>
<li>
<p>Basic Configuration Settings</p>
<div class="ulist">
<ul>
<li>
<p>Number of Instances</p>
</li>
<li>
<p>Autoscaling Policies</p>
</li>
<li>
<p>Metadata</p>
</li>
</ul>
</div>
</li>
<li>
<p>Associated with a Kubernetes <code>Replica Set</code></p>
</li>
<li>
<p>Server Group is a collection of instances of the running software</p>
<div class="ulist">
<ul>
<li>
<p>VM instances</p>
</li>
<li>
<p>Kubernetes pods</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/deployment-overview.png" alt="deployment overview">
</div>
<div class="title">Figure 1. The Deployment is highlighted</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/replica-set-overview.png" alt="replica set overview">
</div>
<div class="title">Figure 2. The Replica Set is highlighted</div>
</div>
</div>
<div class="sect3">
<h4 id="_replica_set_history">Replica Set History</h4>
<div class="ulist">
<ul>
<li>
<p>With deployments history of the deployments are maintained</p>
</li>
<li>
<p>The following shows a history</p>
</li>
<li>
<p>Deployments can be:</p>
<div class="ulist">
<ul>
<li>
<p><em>rolled back</em></p>
</li>
<li>
<p><em>deleted</em></p>
</li>
<li>
<p><em>restarted</em></p>
</li>
<li>
<p><em>scaled</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/deployment-history.png" alt="deployment history">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_load_balancers">Load Balancers</h4>
<div class="ulist">
<ul>
<li>
<p>Load Balancer is associated with:</p>
<div class="ulist">
<ul>
<li>
<p>An ingress protocol</p>
</li>
<li>
<p>Port range</p>
</li>
</ul>
</div>
</li>
<li>
<p>It corresponds to a Kubernetes <em>Service</em></p>
</li>
<li>
<p>It balances traffic among instances in its Server Groups.</p>
</li>
<li>
<p>You can enable health checks for a load balancer</p>
</li>
<li>
<p>Flexibility to define health criteria and specify the health check endpoint.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_firewalls">Firewalls</h4>
<div class="ulist">
<ul>
<li>
<p>Firewall defines network traffic access</p>
</li>
<li>
<p>Firewall rules defined by an IP range (CIDR) along with a communication protocol (e.g., TCP) and port range</p>
</li>
<li>
<p>It is associated with Kubernetes Network Policies</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Source: <a href="https://www.spinnaker.io/reference/providers/kubernetes-v2/#networkpolicies" class="bare">https://www.spinnaker.io/reference/providers/kubernetes-v2/#networkpolicies</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_spinnaker_process">Spinnaker Process</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an Application</p>
<div class="ulist">
<ul>
<li>
<p>One Application per Microservice</p>
</li>
</ul>
</div>
</li>
<li>
<p>Define your Infrastructure</p>
<div class="ulist">
<ul>
<li>
<p>Define infrastructure for each application</p>
</li>
<li>
<p>Pipelines deploy services to the server groups you define</p>
</li>
<li>
<p>NOTE: Not necessary since you can define infrastructure from pipeline</p>
</li>
</ul>
</div>
</li>
<li>
<p>Create a Pipeline</p>
<div class="ulist">
<ul>
<li>
<p>Create all the pipelines needed to deploy the service or services covered by the application</p>
</li>
</ul>
</div>
</li>
<li>
<p>Run your Pipeline</p>
<div class="ulist">
<ul>
<li>
<p>Automatic</p>
</li>
<li>
<p>Triggered</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Source: <a href="https://www.spinnaker.io/guides/user/get-started/" class="bare">https://www.spinnaker.io/guides/user/get-started/</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_pipeline">Pipeline</h4>
<div class="ulist">
<ul>
<li>
<p>Key deployment management construct in Spinnaker</p>
</li>
<li>
<p>Consists of a sequence of actions, known as <em>stages</em></p>
</li>
<li>
<p>Possibility to pass parameters from stage to stage along the pipeline</p>
</li>
<li>
<p>Started manually or triggered by an event:</p>
<div class="ulist">
<ul>
<li>
<p><code>git push</code></p>
</li>
<li>
<p>Docker image upload</p>
</li>
<li>
<p>CRON Schedule</p>
</li>
</ul>
</div>
</li>
<li>
<p>You can emit notifications</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_stage">Stage</h4>
<div class="ulist">
<ul>
<li>
<p>Atomic building block for a pipeline</p>
</li>
<li>
<p>Sequenced to form a pipeline</p>
</li>
<li>
<p>Spinnaker provides multiple stages:</p>
<div class="ulist">
<ul>
<li>
<p>Deploy</p>
</li>
<li>
<p>Resize</p>
</li>
<li>
<p>Disable</p>
</li>
<li>
<p>Manual Judgment</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_deployment_strategies">Deployment Strategies</h4>
<div class="paragraph">
<p>Image of the various Deployment Strategies</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/concepts/deployment-strategies.png" alt="deployment strategies">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Spinnaker treats cloud-native deployment strategies as first class constructs</p>
</li>
<li>
<p>Handling the underlying orchestration such as</p>
<div class="ulist">
<ul>
<li>
<p>Verifying health checks</p>
</li>
<li>
<p>Disabling old server groups</p>
</li>
<li>
<p>Enabling new server groups.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_cluster_definition">Cluster Definition</h4>
<div class="paragraph">
<p>Source: <a href="https://www.spinnaker.io/concepts/clusters/" class="bare">https://www.spinnaker.io/concepts/clusters/</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/concepts/clusters/clusters.png" alt="clusters">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Spinnaker acts as a single pane of glass from which to manage your global deployments across multiple clouds!</p>
</li>
<li>
<p>Contains information related to:</p>
<div class="ulist">
<ul>
<li>
<p>Health and status of running environments</p>
</li>
<li>
<p>Metadata around deployments and individual instances.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Also ability to perform ad-hoc actions you can perform on the resources you see such:</p>
<div class="ulist">
<ul>
<li>
<p>resize</p>
</li>
<li>
<p>clone</p>
</li>
<li>
<p>disable</p>
</li>
<li>
<p>roll back.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Command and control base where we can increasingly layer on information relevant to deploying your applications.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cluster_anatomy">Cluster Anatomy</h3>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/concepts/clusters/clusters.png" alt="clusters">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Left Pane</p>
<div class="ulist">
<ul>
<li>
<p>Filters for viewing your deployed services.</p>
</li>
<li>
<p>Search by string match, or narrow by specific attributes of your services,such as:</p>
<div class="ulist">
<ul>
<li>
<p>Cloud platform</p>
</li>
<li>
<p>Region</p>
</li>
<li>
<p>Designated environments and stacks.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Main Paine</p>
<div class="ulist">
<ul>
<li>
<p>Lists the deployed services.</p>
<div class="ulist">
<ul>
<li>
<p>Here, the green chiclets are individual instances (e.g. an EC2 VM instance, a Kubernetes Pod), grouped into Server Groups (a particular deployment), which are further grouped into Clusters.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Right Pane</p>
<div class="ulist">
<ul>
<li>
<p>Provides details for the item currently selected in the center section</p>
</li>
<li>
<p>For each item, Spinnaker provides details related to both application-level concerns (Jenkins job details) as well as infrastructure-level concerns (machine type, auto-scaling policies).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_pipelines">Pipelines</h3>
<div class="sect3">
<h4 id="_pipeline_definition">Pipeline Definition</h4>
<div class="ulist">
<ul>
<li>
<p>Manage deployments in a consistent, repeatable and safe way.</p>
</li>
<li>
<p>Sequence of stages ranging from functions that manipulate infrastructure (deploy, resize, disable)</p>
<div class="ulist">
<ul>
<li>
<p>Includes <em>scaffolding functions</em> (manual judgment, wait, run Jenkins job) that together precisely defines your runbook for managing your deployments</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_pipeline_anatomy">Pipeline Anatomy</h4>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/concepts/pipelines/edit-pipeline.png" alt="edit pipeline">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Define your sequence of stages at the top.</p>
</li>
<li>
<p>Spinnaker supports parallel paths of stages, as well as the ability to specify whether multiple instances of a pipeline can be run at once.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Specify details for a given stage in the sections below.</p>
</div>
</div>
<div class="sect3">
<h4 id="_viewing_pipeline_execution_history">Viewing Pipeline Execution History</h4>
<div class="ulist">
<ul>
<li>
<p>Serves as a means to introspect details of each deployment operation</p>
</li>
<li>
<p>An effective audit log of enforced processes/policies on how you make changes to your deployed applications landscape.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/concepts/pipelines/pipelines.png" alt="pipelines">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_one_stage_multiple_steps_one_step_multiple_actions">One Stage, Multiple Steps; One Step, Multiple Actions</h4>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/concepts/pipelines/pipeline-tasks.png" alt="pipeline tasks">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Automation does not end with orchestrating only the high-level steps of your release process</p>
</li>
<li>
<p>Each of these operational steps often corresponds to a sequence of calls to the cloud platform</p>
</li>
<li>
<p>Each of which needs to be remediated in failure scenarios</p>
</li>
<li>
<p>The red/black Deploy stage is an example of how Spinnaker fully supports this notion</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the above image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Red/Black Deploy stage in Spinnaker actually entails a sequence of steps</p>
</li>
<li>
<p>Each given step is actually a set of tasks that need polling, remediation to ensure requisite state is reached prior to proceeding</p>
</li>
<li>
<p>A given task often entails multiple API calls to the specific cloud platform, cognizant of expected response codes and remediating actions in failure</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_pipeline_templates">Pipeline Templates</h4>
<div class="paragraph">
<p>Managed pipeline templates are a way to scalably manage pipelines across different teams.</p>
</div>
<div class="paragraph">
<p>Pipeline templates have two main components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Template</p>
<div class="ulist">
<ul>
<li>
<p>A pipeline template defines a parameterized pipeline, with the set of variables for which your users will provide values</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configuration</p>
<div class="ulist">
<ul>
<li>
<p>A <strong>concrete implementation</strong> of a template.</p>
</li>
<li>
<p>Configurations can inject new stages into the final pipeline graph and inherit or override, or both, triggers, notifications, and parameters.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_pipeline_terminology">Pipeline Terminology</h4>
<div class="ulist">
<ul>
<li>
<p>Pipeline template</p>
<div class="ulist">
<ul>
<li>
<p>A parameterized pipeline, minus the pipeline configuration found on a pipeline instance. This template helps developers create pipelines that follow a pattern that you establish.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Pipeline configuration</p>
<div class="ulist">
<ul>
<li>
<p>The same as the configuration for a <em>pipeline not created from a template</em>, plus variable bindings and a reference to the template.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Pipeline</p>
<div class="ulist">
<ul>
<li>
<p>Whether it’s created from a template or not, an executable pipeline that can be visualized in the Deck UI, and can be run by Orca.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Pipeline template variable</p>
<div class="ulist">
<ul>
<li>
<p>A variable defined in a pipeline template, whose value is deteremined when a pipeline is instantiated based on the template. Contrast with pipeline variables, which vary per execution of the pipeline.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cloud_providers">Cloud Providers</h3>
<div class="sect3">
<h4 id="_overview_2">Overview</h4>
<div class="ulist">
<ul>
<li>
<p>A Cloud Provider is an interface to a set of virtual resources that Spinnaker has control over.</p>
</li>
<li>
<p>Typically, this is a IaaS provider, like AWS, or GCP</p>
</li>
<li>
<p>It can also be a PaaS, like App Engine, or a container Orchestrator, like Kubernetes.</p>
</li>
<li>
<p>The cloud provider is central to everything you do in Spinnaker.</p>
<div class="ulist">
<ul>
<li>
<p>It’s where you deploy your Server Groups, the source of your deployable artifacts</p>
</li>
<li>
<p>and the subject of automation via Pipelines.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_accounts">Accounts</h4>
<div class="ulist">
<ul>
<li>
<p>An Account is a named credential Spinnaker uses to authenticate against a cloud provider.</p>
</li>
<li>
<p>Each provider has slightly different requirements for what format credentials can be in, and what permissions they need to have afforded to them.</p>
</li>
<li>
<p>Each Supported Provider has their own way to create an account and register the credentials with <strong>Halyard</strong>.</p>
</li>
<li>
<p>Keep in mind that every Provider can have as many accounts added as desired</p>
<div class="ulist">
<ul>
<li>
<p>This will allow you to keep your environments (e.g. staging vs. prod):</p>
<div class="ulist">
<ul>
<li>
<p>Separate</p>
</li>
<li>
<p>Restrict access to sets of resources using Spinnaker’s Authorization mechanisms</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_cloud_providers_supported">Cloud Providers Supported</h4>
<div class="ulist">
<ul>
<li>
<p>App Engine</p>
</li>
<li>
<p>Amazon Web Services</p>
</li>
<li>
<p>Azure</p>
</li>
<li>
<p>Cloud Foundry</p>
</li>
<li>
<p>DC/OS</p>
</li>
<li>
<p>Docker v2 Registry (Note: This only acts as a source of images, and does not include support for deploying Docker images)</p>
</li>
<li>
<p>Google Compute Engine</p>
</li>
<li>
<p>Kubernetes</p>
</li>
<li>
<p>Oracle</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_the_process">The Process</h4>
<div class="ulist">
<ul>
<li>
<p>Install Halyard</p>
</li>
<li>
<p>Choose a Cloud Provider</p>
</li>
<li>
<p>Choose an Environment</p>
</li>
<li>
<p>Choose a Storage Service</p>
</li>
<li>
<p>Deploy Spinnaker</p>
</li>
<li>
<p>Backup your Configuration</p>
</li>
<li>
<p>Configure everything else</p>
</li>
<li>
<p>Productionalize Spinnaker</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Source: <a href="https://www.spinnaker.io/setup/install/" class="bare">https://www.spinnaker.io/setup/install/</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_application_deployment">Application Deployment</h4>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/concepts/pipelines.png" alt="pipelines">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preliminaries">Preliminaries</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_a_typical_install_for_administrators_of_spinnaker">A typical install for administrators of Spinnaker</h3>
<div class="paragraph">
<p>While not all necessary for this course, an administrator will typically require the following</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>brew</code>, <code>pip</code>, or both</p>
</li>
<li>
<p><code>kubectl</code></p>
</li>
<li>
<p><code>awscliv2</code></p>
</li>
<li>
<p><code>eksctl</code></p>
</li>
<li>
<p><code>hal</code></p>
</li>
<li>
<p><code>terraform</code></p>
</li>
<li>
<p><code>helm</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_install_kubectl">Install <code>kubectl</code></h3>
<div class="sect3">
<h4 id="_install_on_macosx">Install on MacOSX</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>brew install kubectl</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_install_on_linux">Install on Linux</h4>
<div class="paragraph">
<p>Run the following <code>curl</code> download</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>curl -LO https://storage.googleapis.com/kubernetes-release/release/&lt;code&gt;curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt&lt;/code&gt;/bin/linux/amd64/kubectl</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make <code>kubectl</code> binary executable</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>chmod +x ./kubectl</code></pre>
</div>
</div>
<div class="paragraph">
<p>Move the binary to the <code>PATH</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>sudo mv ./kubectl /usr/local/bin/kubectl</code></pre>
</div>
</div>
<div class="paragraph">
<p>Test</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>kubectl version</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_awscli">Install <code>awscli</code></h3>
<div class="sect3">
<h4 id="_install_on_macosx_2">Install on MacOSX:</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>curl <span class="tok-s2">&quot;https://d1vvhvl2y92vvt.cloudfront.net/awscli-exe-macos.zip&quot;</span> -o <span class="tok-s2">&quot;awscliv2.zip&quot;</span>
unzip awscliv2.zip
sudo ./aws/install</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_install_on_linux_2">Install on Linux:</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>curl <span class="tok-s2">&quot;https://d1vvhvl2y92vvt.cloudfront.net/awscli-exe-linux-x86_64.zip&quot;</span> -o <span class="tok-s2">&quot;awscliv2.zip&quot;</span>
unzip awscliv2.zip
sudo ./aws/install</code></pre>
</div>
</div>
<div class="paragraph">
<p>Source: <a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html" class="bare">https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_hal">Install <code>hal</code></h3>
<div class="sect3">
<h4 id="_download_for_macosx">Download for MacOSX:</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>curl -O https://raw.githubusercontent.com/spinnaker/halyard/master/install/macos/InstallHalyard.sh</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_download_for_linux">Download for Linux:</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>curl -O https://raw.githubusercontent.com/spinnaker/halyard/master/install/debian/InstallHalyard.sh</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_perform_installation">Perform Installation:</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>sudo bash InstallHalyard.sh</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_check_version">Check version</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal -v</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this doesn&#8217;t work re-check configuration</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_your_aws_cli_credentials">Configure Your AWS CLI Credentials</h3>
<div class="ulist">
<ul>
<li>
<p>Both <code>eksctl</code> and the AWS CLI require that you have AWS credentials configured in your environment.</p>
</li>
<li>
<p>The aws configure command is the fastest way to set up your AWS CLI installation for general use.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>$ aws configure
AWS Access Key ID <span class="tok-o">[</span>None<span class="tok-o">]</span>: AKIAIOSRODNN2EXAMPLE
AWS Secret Access Key <span class="tok-o">[</span>None<span class="tok-o">]</span>: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
Default region name <span class="tok-o">[</span>None<span class="tok-o">]</span>: us-west-2
Default output format <span class="tok-o">[</span>None<span class="tok-o">]</span>: json</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_eksctl_for_macosx">Install <code>eksctl</code> for MacOSX</h3>
<div class="paragraph">
<p>Add Weaveworks Tap to `brew</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>brew tap weaveworks/tap</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>brew install weaveworks/tap/eksctl</code></pre>
</div>
</div>
<div class="paragraph">
<p>Test</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>eksctl version</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_eksctl_for_linux">Install <code>eksctl</code> for Linux</h3>
<div class="paragraph">
<p>To install or upgrade eksctl on Linux using <code>curl</code></p>
</div>
<div class="paragraph">
<p>Download and extract the latest release of eksctl with the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>curl --silent --location <span class="tok-s2">&quot;https://github.com/weaveworks/eksctl/releases/download/latest_release/eksctl_</span><span class="tok-k">$(</span>uname -s<span class="tok-k">)</span><span class="tok-s2">_amd64.tar.gz&quot;</span> <span class="tok-p">|</span> tar xz -C /tmp
Move the extracted binary to /usr/local/bin.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>sudo mv /tmp/eksctl /usr/local/bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Test that your installation was successful with the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>eksctl version</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_terraform">Install Terraform</h3>
<div class="ulist">
<ul>
<li>
<p>Find the appropriate package for your system <a href="https://www.terraform.io/downloads.html">here</a> and download it. Terraform is packaged as a zip archive.</p>
</li>
<li>
<p>After downloading Terraform, unzip the package.</p>
</li>
<li>
<p>Terraform runs as a single binary named <code>terraform</code>.</p>
</li>
<li>
<p>Any other files in the package can be safely removed and Terraform will still function.</p>
</li>
<li>
<p>Make sure that the terraform binary is available on the PATH.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_install_helm">Install Helm</h3>
<div class="sect3">
<h4 id="_install_brew_on_macosx_using_brew">Install Brew on MacOSX Using Brew</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>brew install helm</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_install_on_linux_3">Install on Linux</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
chmod <span class="tok-m">700</span> get_helm.sh
./get_helm.sh</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installing_in_aws_eks">Installing in AWS EKS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_system_requirements">System Requirements</h3>
<div class="ulist">
<ul>
<li>
<p>18 GB of RAM</p>
</li>
<li>
<p>A 4 core CPU</p>
</li>
<li>
<p>Ubuntu 14.04, 16.04 or 18.04</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_installing_eks_on_amazon">Installing EKS on Amazon</h3>
<div class="ulist">
<ul>
<li>
<p>For Production on AWS, using <code>eksctl</code></p>
</li>
<li>
<p>The following command will create maximum of 4 node for spinnaker</p>
</li>
<li>
<p>Select appropriate node types, in this case <em>t2.xlarge</em>, although for this class <em>t3.medium</em></p>
</li>
<li>
<p>This will create a node group called <code>spin-eks-node</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>eksctl create cluster <span class="tok-se">\</span>
    --name eks-prod <span class="tok-se">\</span>
    --version <span class="tok-m">1</span>.14 <span class="tok-se">\</span>
    --nodegroup-name eks-prod-nodegroup <span class="tok-se">\</span>
    --node-type t3.medium <span class="tok-se">\</span>
    --nodes <span class="tok-m">4</span> <span class="tok-se">\</span>
    --nodes-min <span class="tok-m">0</span> <span class="tok-se">\</span>
    --nodes-max <span class="tok-m">4</span> <span class="tok-se">\</span>
    --node-ami auto <span class="tok-se">\</span>
    --write-kubeconfig<span class="tok-o">=</span><span class="tok-nb">false</span>

eksctl create cluster <span class="tok-se">\</span>
    --name eks-stage <span class="tok-se">\</span>
    --version <span class="tok-m">1</span>.14 <span class="tok-se">\</span>
    --nodegroup-name eks-stage-nodegroup <span class="tok-se">\</span>
    --node-type t3.medium <span class="tok-se">\</span>
    --nodes <span class="tok-m">4</span> <span class="tok-se">\</span>
    --nodes-min <span class="tok-m">0</span> <span class="tok-se">\</span>
    --nodes-max <span class="tok-m">4</span> <span class="tok-se">\</span>
    --node-ami auto <span class="tok-se">\</span>
    --write-kubeconfig<span class="tok-o">=</span><span class="tok-nb">false</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The instructions on the spinnaker website are horrible and the CloudFormation templates are old
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This can take a few minutes to get started
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_update_your_kubeconfig_file">Update your <code>kubeconfig</code> file</h3>
<div class="paragraph">
<p>Before running your process please backup your original <code>kubectl</code> file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>aws2 eks update-kubeconfig --name eks-prod --region us-west-2 --alias eks-prod
aws2 eks update-kubeconfig --name eks-stage --region us-west-2 --alias eks-stage</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_change_context_to_use_kubernetes_on_eks">Change Context to Use Kubernetes on EKS</h3>
<div class="paragraph">
<p>Find all the current contexts to use in Kubernetes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>kubectl config get-contexts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Select the context that was just updated by <code>aws eks update-kubeconfig</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>kubectl config use-context &lt;name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Determine that your nodes are running</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>kubectl get nodes --all-namespaces</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_halyard">Halyard</h3>
<div class="imageblock">
<div class="content">
<img src="./images/halyard.png" alt="halyard" width="50%" height="60%">
</div>
</div>
<div class="sect3">
<h4 id="_enabling_kubernetes_cloud_using_haylard">Enabling Kubernetes Cloud Using Haylard</h4>
<div class="ulist">
<ul>
<li>
<p>Halyard is a tool that uploads the kubernetes configuration files for you</p>
</li>
<li>
<p>Accounts are just variable names representing external services</p>
</li>
<li>
<p>Ensure that you are in the right context in Kubernetes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config provider kubernetes <span class="tok-nb">enable</span>
kubectl config use-context eks-prod
hal config provider kubernetes account add eks-prod --provider-version v2 --context <span class="tok-k">$(</span>kubectl config current-context<span class="tok-k">)</span>
kubectl config use-context eks-stage
hal config provider kubernetes account add eks-stage --provider-version v2 --context <span class="tok-k">$(</span>kubectl config current-context<span class="tok-k">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enable_external_resources_called_artifacts">Enable external resources (called artifacts)</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config features edit --artifacts <span class="tok-nb">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To view a list of your Halyard Kubernetes accounts <em>after enabling kubernetes</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config provider kubernetes account list</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_storage_solutions">Setting up Storage Solutions</h4>
<div class="ulist">
<ul>
<li>
<p>Set up persistent storage for your Spinnaker instance by choosing one of the options below</p>
</li>
<li>
<p>Ensure that the region supports S3</p>
</li>
<li>
<p>You can find your <code>ACCESS_KEY_ID</code> and your <code>AWS_SECRET_ACCESS_KEY</code> in <code>~/.aws/credentials</code></p>
</li>
<li>
<p>Use the same region as your kubernetes cluster, this was displayed by <code>eksctl</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config storage s3 edit <span class="tok-se">\</span>
    --access-key-id <span class="tok-nv">$YOUR_ACCESS_KEY_ID</span> <span class="tok-se">\</span>
    --secret-access-key <span class="tok-se">\</span>
    --region <span class="tok-nv">$REGION</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_linking_halyard_to_s3">Linking Halyard to S3</h4>
<div class="paragraph">
<p>Finally set up the storage to S3 for Halyard so it knows what to do</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config storage edit --type s3</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_a_service_account_to_prod">Setting up a Service Account to Prod</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>kubectl config use-context eks-prod
<span class="tok-nv">CONTEXT</span><span class="tok-o">=</span><span class="tok-k">$(</span>kubectl config current-context<span class="tok-k">)</span>
kubectl apply --context <span class="tok-nv">$CONTEXT</span> -f https://spinnaker.io/downloads/kubernetes/service-account.yml
<span class="tok-nv">TOKEN</span><span class="tok-o">=</span><span class="tok-k">$(</span>kubectl get secret --context <span class="tok-nv">$CONTEXT</span> <span class="tok-se">\</span>
   <span class="tok-k">$(</span>kubectl get serviceaccount spinnaker-service-account <span class="tok-se">\</span>
       --context <span class="tok-nv">$CONTEXT</span> <span class="tok-se">\</span>
       -n spinnaker <span class="tok-se">\</span>
       -o <span class="tok-nv">jsonpath</span><span class="tok-o">=</span><span class="tok-s1">&#39;{.secrets[0].name}&#39;</span><span class="tok-k">)</span> <span class="tok-se">\</span>
   -n spinnaker <span class="tok-se">\</span>
   -o <span class="tok-nv">jsonpath</span><span class="tok-o">=</span><span class="tok-s1">&#39;{.data.token}&#39;</span> <span class="tok-p">|</span> base64 --decode<span class="tok-k">)</span>
kubectl config set-credentials <span class="tok-si">${</span><span class="tok-nv">CONTEXT</span><span class="tok-si">}</span>-token-user --token <span class="tok-nv">$TOKEN</span>
kubectl config set-context <span class="tok-nv">$CONTEXT</span> --user <span class="tok-si">${</span><span class="tok-nv">CONTEXT</span><span class="tok-si">}</span>-token-user</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_a_service_account_to_stage">Setting up a Service Account to Stage</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span><span class="tok-c1">#Setting up Credentials for Stage</span>

kubectl config use-context eks-stage
<span class="tok-nv">CONTEXT</span><span class="tok-o">=</span><span class="tok-k">$(</span>kubectl config current-context<span class="tok-k">)</span>
kubectl apply --context <span class="tok-nv">$CONTEXT</span> -f https://spinnaker.io/downloads/kubernetes/service-account.yml
<span class="tok-nv">TOKEN</span><span class="tok-o">=</span><span class="tok-k">$(</span>kubectl get secret --context <span class="tok-nv">$CONTEXT</span> <span class="tok-se">\</span>
   <span class="tok-k">$(</span>kubectl get serviceaccount spinnaker-service-account <span class="tok-se">\</span>
       --context <span class="tok-nv">$CONTEXT</span> <span class="tok-se">\</span>
       -n spinnaker <span class="tok-se">\</span>
       -o <span class="tok-nv">jsonpath</span><span class="tok-o">=</span><span class="tok-s1">&#39;{.secrets[0].name}&#39;</span><span class="tok-k">)</span> <span class="tok-se">\</span>
   -n spinnaker <span class="tok-se">\</span>
   -o <span class="tok-nv">jsonpath</span><span class="tok-o">=</span><span class="tok-s1">&#39;{.data.token}&#39;</span> <span class="tok-p">|</span> base64 --decode<span class="tok-k">)</span>
kubectl config set-credentials <span class="tok-si">${</span><span class="tok-nv">CONTEXT</span><span class="tok-si">}</span>-token-user --token <span class="tok-nv">$TOKEN</span>
kubectl config set-context <span class="tok-nv">$CONTEXT</span> --user <span class="tok-si">${</span><span class="tok-nv">CONTEXT</span><span class="tok-si">}</span>-token-user</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tell_hal_where_to_deploy">Tell <code>hal</code> where to deploy</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config provider kubernetes account add eks-stage --provider-version v2 --context eks-stage</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_spinnaker">Deploy Spinnaker</h3>
<div class="paragraph">
<p>List the available versions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal version list</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can follow the links to the versions’ respective changelogs to see what features each adds.</p>
</div>
<div class="paragraph">
<p>Set the version you want to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config version edit --version <span class="tok-nv">$VERSION</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_deploy_spinnaker_2">Deploy Spinnaker</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal deploy apply</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_undeploy_spinnaker">Undeploy Spinnaker</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal deploy clean</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The information is persisted on S3
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_connect_to_spinnaker_ui">Connect to Spinnaker UI</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal deploy connect</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This command automatically forwards ports 9000 (Deck UI) and 8084 (Gate API service).</p>
</li>
<li>
<p>Navigate to <a href="https://localhost:9000" class="bare">https://localhost:9000</a></p>
</li>
<li>
<p>Give it some time, the services need to start</p>
</li>
<li>
<p>Determine the status by running the following:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>kubectl get pods --namespace spinnaker</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>kubectl get pods --namespace spinnaker</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_if_you_ever_need_to_expose_publicly">If you ever need to expose publicly</h4>
<div class="ulist">
<ul>
<li>
<p>Everything in Spinnaker is a microservice interacting with one another</p>
</li>
<li>
<p>As such, we can expose these services</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span><span class="tok-nb">export</span> <span class="tok-nv">NAMESPACE</span><span class="tok-o">=</span>spinnaker
kubectl -n <span class="tok-si">${</span><span class="tok-nv">NAMESPACE</span><span class="tok-si">}</span> expose service spin-gate --type LoadBalancer --port <span class="tok-m">80</span> --target-port <span class="tok-m">8084</span> --name spin-gate-public
kubectl -n <span class="tok-si">${</span><span class="tok-nv">NAMESPACE</span><span class="tok-si">}</span> expose service spin-deck --type LoadBalancer --port <span class="tok-m">80</span> --target-port <span class="tok-m">9000</span> --name spin-deck-public

<span class="tok-nb">export</span> <span class="tok-nv">API_URL</span><span class="tok-o">=</span><span class="tok-k">$(</span>kubectl -n <span class="tok-nv">$NAMESPACE</span> get svc spin-gate-public -o <span class="tok-nv">jsonpath</span><span class="tok-o">=</span><span class="tok-s1">&#39;{.status.loadBalancer.ingress[0].hostname}&#39;</span><span class="tok-k">)</span>
<span class="tok-nb">export</span> <span class="tok-nv">UI_URL</span><span class="tok-o">=</span><span class="tok-k">$(</span>kubectl -n <span class="tok-nv">$NAMESPACE</span> get svc spin-deck-public -o <span class="tok-nv">jsonpath</span><span class="tok-o">=</span><span class="tok-s1">&#39;{.status.loadBalancer.ingress[0].hostname}&#39;</span><span class="tok-k">)</span>

hal config security api edit --override-base-url http://<span class="tok-nv">$API_URL</span>
hal config security ui edit --override-base-url http://<span class="tok-nv">$UI_URL</span>

hal deploy apply

kubectl -n spinnaker get svc</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_something_is_wrong">Something is wrong?</h4>
<div class="paragraph">
<p>It is worth while at time when you get started to look at the logs of your <code>pod</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>kubectl logs &lt;pod-name&gt; -n &lt;namespace&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>kubectl describe &lt;pod-name&gt; -n &lt;namespace&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deleting_your_cluster">Deleting your cluster</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>eksctl delete cluster --name my-eks-cluster</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spinnaker_architecture">Spinnaker Architecture</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_describe_the_services">Describe the Services</h3>
<div class="paragraph">
<p>Here is a list of the services that are deployed with Spinnaker</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clouddriver - Main integration point for Spinnaker cloud providers like:</p>
<div class="ulist">
<ul>
<li>
<p>AWS</p>
</li>
<li>
<p>GCE</p>
</li>
<li>
<p>CloudFoundry</p>
</li>
<li>
<p>Azure etc.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Deck - Management UI for Spinnaker</p>
</li>
<li>
<p>Orca - Orchestration Engine</p>
</li>
<li>
<p>Gate - Spinnaker API Gateway</p>
</li>
<li>
<p>Rosco - A Bakery for Deployable Engines</p>
</li>
<li>
<p>Echo - Eventing Service</p>
</li>
<li>
<p>Front 50 - Spinnaker Metadata Repository Service</p>
</li>
<li>
<p>Redis - Spinnaker relies on its Redis cache for a number of reasons</p>
<div class="ulist">
<ul>
<li>
<p>Caching Infrastructure</p>
</li>
<li>
<p>Storing live executions</p>
</li>
<li>
<p>Returning pipeline definitions faster</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Kayenta - Service that integrates with metric systems like Prometheus to track data</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_debugging">Debugging</h3>
<div class="ulist">
<ul>
<li>
<p>Each Java service can be configured to listen for a debugger.</p>
</li>
<li>
<p>To start the JVM in debug mode, set the Java system property <code>DEBUG=true</code></p>
</li>
<li>
<p>The JVM will then listen for a debugger to be attached on a port specific to that service.</p>
</li>
<li>
<p>The service-specific debug ports are as follows:</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8184</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Orca</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8183</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clouddriver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7102</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Front50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8180</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rosco</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8187</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Igor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8188</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Echo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8189</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploying_microservices">Deploying Microservices</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_process_2">The Process</h3>
<div class="imageblock">
<div class="content">
<img src="./images/process.png" alt="process">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_steps">The Steps</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Setup a repository for a microservice</p>
</li>
<li>
<p>Setup a CI application to run unit integration tests</p>
</li>
<li>
<p>Create an Spinnaker Application</p>
</li>
<li>
<p>Define the Infrastructure</p>
</li>
<li>
<p>Create a Pipeline</p>
</li>
<li>
<p>Run your Pipeline</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Source: <a href="https://www.spinnaker.io/guides/user/get-started/" class="bare">https://www.spinnaker.io/guides/user/get-started/</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_create_an_application">Create an Application</h3>
<div class="ulist">
<ul>
<li>
<p>One Application per Microservice</p>
</li>
<li>
<p>This is the root where we will begin</p>
</li>
<li>
<p>Note that your application configuration affects what you can do with Spinnaker—you can enable or disable some Spinnaker features.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_about_an_application">About an Application</h4>
<div class="ulist">
<ul>
<li>
<p>An application in Spinnaker is a construct that represents some service that you are going to deploy (typically a microservice).</p>
</li>
<li>
<p>It includes:</p>
<div class="ulist">
<ul>
<li>
<p>The pipelines that process the service through to deployment in production</p>
</li>
<li>
<p>The infrastructure on which the service is run:</p>
<div class="ulist">
<ul>
<li>
<p>Clusters</p>
</li>
<li>
<p>Server Groups</p>
</li>
<li>
<p>Firewalls</p>
</li>
<li>
<p>Load Balancers</p>
</li>
<li>
<p>Canary Configs</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_creating_the_application">Creating the Application</h4>
<div class="imageblock">
<div class="content">
<img src="./images/create_application_action.png" alt="create application action">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can’t create a deployment pipeline unless you have an application to put it in.</p>
</li>
<li>
<p>Click on the <strong>Applications</strong> tab</p>
</li>
<li>
<p>Click on Create Application</p>
</li>
<li>
<p>Provide the attributes for the new Application</p>
</li>
<li>
<p>Click Create</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_application_attributes">Application Attributes</h4>
<div class="imageblock text-center">
<div class="content">
<img src="./images/create_application.png" alt="create application" width="50%" height="50%">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A unique name to identify this application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Owner Email</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The email address of the owner of this application, within your installation of Spinnaker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Repo type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The platform hosting the code repository for this application. Stash, Bitbucket, or GitHub.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this text field to describe the application, if necessary.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Consider only cloud provider health</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool, default=no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, instance status as reported by the cloud provider is considered sufficient to determine task completion. When disabled, tasks need health status reported by some other health provider (load balancer, discovery service).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Show health override option</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool, default=no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, users can toggle previous option per task.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Instance port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field is used to generate links from Spinnaker instance details to a running instance. The instance port can be used or overridden for specific links configured for your application (via the Config screen).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Enable restarting running pipelines</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool, default=no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, users can restart pipeline stages while a pipeline is still running. This behavior is not recommended.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_editing_the_configuration">Editing the Configuration</h3>
<div class="paragraph">
<p>If you need to go back and edit your configuration you can hit the config button on the upper right hand side</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/config_small_button.png" alt="config small button" width="40%" height="40%">
</div>
</div>
<div class="paragraph">
<p>The Configuration has some of the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Edit Notifications</p>
</li>
<li>
<p>Features</p>
</li>
<li>
<p>Links</p>
</li>
<li>
<p>Traffic Guards</p>
</li>
<li>
<p>Custom Banners</p>
</li>
<li>
<p>Delete Application</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_editing_notifications">Editing Notifications</h3>
<div class="paragraph">
<p>Spinnaker can send notification for any application and are optional</p>
</div>
<div class="paragraph">
<p>Click <strong>Add Notification Preferences</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the notification medium:</p>
<div class="ulist">
<ul>
<li>
<p>Email</p>
</li>
<li>
<p>SMS</p>
</li>
<li>
<p>Slack</p>
</li>
</ul>
</div>
</li>
<li>
<p>Provide the information for the type you chose:</p>
<div class="ulist">
<ul>
<li>
<p>Email address</p>
</li>
<li>
<p>Phone number</p>
</li>
</ul>
</div>
</li>
<li>
<p>Choose each pipeline event that will trigger this notification:</p>
<div class="ulist">
<ul>
<li>
<p>A pipeline started</p>
</li>
<li>
<p>A pipeline finished</p>
</li>
<li>
<p>A pipeline failed</p>
</li>
</ul>
</div>
</li>
<li>
<p>For each event, enter any custom text you want included in the notification.</p>
</li>
<li>
<p>Click <strong>Update</strong></p>
</li>
<li>
<p>Repeat these steps to add more notifications, if you want.</p>
</li>
<li>
<p>Click <strong>Edit</strong> next to any existing notification to change its preferences, or click <strong>Remove</strong> to delete it.</p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/event_notification_prefs.png" alt="event notification prefs">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_features_in_spinnaker">Enabling Features in Spinnaker</h3>
<div class="paragraph">
<p>In order to not allow Spinnaker from annoying you about resources you don&#8217;t use you can turn them off</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/features_panel.png" alt="features panel">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_links">Custom Links</h3>
<div class="ulist">
<ul>
<li>
<p>You can include custom links to the instance details panel, providing shortcuts to information related to the instance, like logs, health, and so on.</p>
</li>
<li>
<p>It currently doesn&#8217;t work with Kubernetes resources unless exposed from cluster</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/custom_links.png" alt="custom links">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Links</strong> section, click <strong>Add Section</strong></p>
</li>
<li>
<p>Provide text for the new <strong>Section heading</strong>.</p>
</li>
<li>
<p>In the <strong>Links</strong> fields, type the text that you want to display, and the path to the link target.</p>
</li>
<li>
<p>You can reference these specific instance attributes by wrapping them in curly braces. For example, to include the region where the instance lives, for a GCE or AWS instance, use <code>{region}</code>. These are for the path only, not the link display text.</p>
</li>
<li>
<p>Click <strong>Add Link</strong> for each additional link you want displayed in this section.</p>
</li>
<li>
<p>Click <strong>Add Section</strong> for any additional sections.</p>
</li>
<li>
<p>Click <strong>Revert</strong> to clear your work in progress.</p>
</li>
<li>
<p>This does not remove any saved custom instance links.</p>
</li>
<li>
<p>Click <strong>Save Changes</strong> when you’re finished.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_traffic_guards">Traffic Guards</h3>
<div class="imageblock text-center">
<div class="content">
<img src="./images/traffic_guards.png" alt="traffic guards">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A traffic guard is a cluster which you have designated as always having at least one active instance.</p>
</li>
<li>
<p>With traffic guard enabled, if a user or process tries to delete, disable, or resize the server group, Spinnaker will verify the operation will not leave the cluster with no active instances, and fail the operation if it would.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the Traffic Guards section:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <strong>Add Traffic Guard</strong></p>
</li>
<li>
<p>Set the following values as seen in table below</p>
</li>
<li>
<p>Click <strong>Save Changes</strong> to apply your new traffic guard, or changes to an existing one</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Required?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The account for which you’re setting up the traffic guard</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Region</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The applicable region from the list, or * for all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The stack to which to apply this traffic guard. Leave blank to apply the guard only to a cluster that has no stack.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Detail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The detail string necessary to identify this cluster via the application-stack-detail naming convention</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_custom_banners_and_deleting_the_application">Custom Banners and Deleting the Application</h3>
<div class="imageblock">
<div class="content">
<img src="./images/banner.png" alt="banner">
</div>
</div>
<div class="paragraph">
<p>You can create simple text based banners</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Add Banner</strong></p>
</li>
<li>
<p>Click <strong>Enable</strong> to enable the banner</p>
</li>
<li>
<p>Select a text color for the foreground color</p>
</li>
<li>
<p>Select a background color for the background color</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_define_the_infrastructure_the_service_will_run">Define the Infrastructure the Service will run</h3>
<div class="ulist">
<ul>
<li>
<p>You define infrastructure for each application.</p>
</li>
<li>
<p>Your pipelines deploys services to the server groups you define.</p>
</li>
<li>
<p>This means that production environments can be deployed without a pipeline.</p>
</li>
<li>
<p>This will provide you with the initial production environement</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
this step is not a prerequisite for creating pipelines. In fact, you can use pipelines to create infrastructure.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_pipelines_2">Pipelines</h3>
<div class="ulist">
<ul>
<li>
<p>How we control and deploy our application</p>
</li>
<li>
<p>Series of stages that can be combined in any order</p>
</li>
<li>
<p>Can be automatic or manual</p>
</li>
<li>
<p>Triggered by a wide arrange of inputs</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_pipeline">Create a Pipeline</h3>
<div class="ulist">
<ul>
<li>
<p>After creating the Application, navigate the <strong>Pipelines</strong> tab in your navigation</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/create.png" alt="create">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Name your pipeline</p>
</li>
<li>
<p>Then add stages</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_stage">Configuration Stage</h3>
<div class="ulist">
<ul>
<li>
<p>The initial stage that you are provided is the configuration stage</p>
</li>
<li>
<p>It is where we define:</p>
<div class="ulist">
<ul>
<li>
<p><em>expected artifacts</em></p>
</li>
<li>
<p><em>triggers</em></p>
</li>
<li>
<p><em>parameters</em></p>
</li>
<li>
<p><em>notifications</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_adding_stages">Adding Stages</h3>
<div class="ulist">
<ul>
<li>
<p>The first step in any pipeline is <strong>Configuration</strong>, where you can set up pipeline triggers and parameters.</p>
</li>
<li>
<p>Each stage specifies an action the pipeline will take once it’s configured.</p>
</li>
<li>
<p>The steps include</p>
<div class="ulist">
<ul>
<li>
<p>Select Add stage from your pipeline configuration screen.</p>
</li>
<li>
<p>Set the stage type using the drop-down menu.</p>
</li>
<li>
<p>If this isn’t the first stage in your pipeline, make sure that this stage depends on the desired upstream stage(s) using the Depends on field.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/add-stage.png" alt="add stage">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/stage-depends-on.png" alt="stage depends on">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manually_run_your_pipeline">Manually Run your Pipeline</h3>
<div class="paragraph">
<p>You can run a pipeline manually, but most pipelines are triggered automatically.
If you so care to, particularly if you don&#8217;t want to redo the build, you can click on <strong>Start Manual Execution</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/manual-execution.png" alt="manual execution">
</div>
</div>
<div class="sect3">
<h4 id="_disabling_a_pipeline">Disabling a Pipeline</h4>
<div class="ulist">
<ul>
<li>
<p>From the Pipelines tab, click <strong>Configure</strong> to modify an existing pipeline</p>
</li>
<li>
<p>Click Pipeline actions in the upper right corner, and select <strong>Disable</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/pipeline-actions.png" alt="pipeline actions">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deleting_a_pipeline">Deleting a Pipeline</h3>
<div class="ulist">
<ul>
<li>
<p>From the Pipelines tab, click <strong>Configure</strong> to modify an existing pipeline.</p>
</li>
<li>
<p>Click <strong>Pipeline actions</strong> in the upper right corner, and select <strong>Delete</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/pipeline-actions.png" alt="pipeline actions">
</div>
</div>
<div class="sect3">
<h4 id="_editing_as_json">Editing as JSON</h4>
<div class="ulist">
<ul>
<li>
<p>You can also edit your pipeline in JSON</p>
</li>
<li>
<p>This is fraught with danger if you get it wrong</p>
</li>
<li>
<p>It can be helpful if things go wrong already</p>
<div class="ulist">
<ul>
<li>
<p>Perhaps the UI is not updating the backend correctly</p>
</li>
<li>
<p>You wish to diagnose issues</p>
</li>
</ul>
</div>
</li>
<li>
<p>When you use the <strong>Edit as JSON</strong> feature, you are directly editing the payload.</p>
</li>
<li>
<p>Edit as JSON allows you to set pipeline fields or properties not exposed by the UI.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/pipeline-actions.png" alt="pipeline actions">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_revision_history">Revision History</h4>
<div class="ulist">
<ul>
<li>
<p>Each time you save your pipeline, the current version is added to revision history</p>
</li>
<li>
<p>You can use revision history to diff two versions of a pipeline or to restore an older version of a pipeline.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>Pipelines</strong> tab, click <strong>Configure</strong> to modify an existing pipeline</p>
</li>
<li>
<p>Click <strong>Pipeline Actions</strong> in the upper right corner, and select <strong>View revision history</strong></p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/pipeline-actions.png" alt="pipeline actions">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_changing_versions">Changing Versions</h4>
<div class="ulist">
<ul>
<li>
<p>You can compare any version of your pipeline to either the version before it or the current pipeline.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>View the version history</p>
</li>
<li>
<p>Select a version from the Revision drop-down.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/revision-history.png" alt="revision history">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_comparing_version">Comparing Version</h4>
<div class="paragraph">
<p>You can also compare a review to either the current revision or the previous one</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/compare-version.png" alt="compare version">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reverting_your_pipeline">Reverting your Pipeline</h4>
<div class="paragraph">
<p>If you select a different version, you can revert to that same version</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/restore-revision.png" alt="restore revision">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rename_a_pipeline">Rename a Pipeline</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>Pipelines</strong> tab, click <strong>Configure</strong> to modify an existing pipeline.</p>
</li>
<li>
<p>Click <strong>Pipeline actions</strong> in the upper right corner, and select <strong>Rename</strong></p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/pipeline-actions.png" alt="pipeline actions">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_artifacts">Artifacts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_artifacts_in_spinnaker">Artifacts in Spinnaker</h3>
<div class="ulist">
<ul>
<li>
<p>Named JSON object that refers to an external resource</p>
<div class="ulist">
<ul>
<li>
<p>A Docker image</p>
</li>
<li>
<p>A file stored in GitHub</p>
</li>
<li>
<p>An Amazon Machine Image (AMI)</p>
</li>
<li>
<p>A binary blob in Amazon S3, Google Cloud Storage, etc.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_artifact_frustration">Artifact Frustration</h3>
<div class="paragraph">
<p>Artifacts are one of the most frustrating aspects to Spinnaker</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>Failed on startup: Unmatched expected artifact ExpectedArtifact<span class="tok-o">(</span><span class="tok-nv">matchArtifact</span><span class="tok-o">=</span>Artifact<span class="tok-o">(</span><span class="tok-nv">type</span><span class="tok-o">=</span>s3/object, <span class="tok-nv">customKind</span><span class="tok-o">=</span>false, <span class="tok-nv">name</span><span class="tok-o">=</span>s3://XXXXXXXXXXX-alpha.191%2B926bb3b3.tgz, <span class="tok-nv">version</span><span class="tok-o">=</span>null, <span class="tok-nv">location</span><span class="tok-o">=</span>null, <span class="tok-nv">reference</span><span class="tok-o">=</span>null, <span class="tok-nv">metadata</span><span class="tok-o">={</span><span class="tok-nv">id</span><span class="tok-o">=</span>01317db7-1e30-4c02-a302-826449d83f94<span class="tok-o">}</span>, <span class="tok-nv">artifactAccount</span><span class="tok-o">=</span>f5cs-spin, <span class="tok-nv">provenance</span><span class="tok-o">=</span>null, <span class="tok-nv">uuid</span><span class="tok-o">=</span>null<span class="tok-o">)</span>, <span class="tok-nv">usePriorArtifact</span><span class="tok-o">=</span>false, <span class="tok-nv">useDefaultArtifact</span><span class="tok-o">=</span>false, <span class="tok-nv">defaultArtifact</span><span class="tok-o">=</span>Artifact<span class="tok-o">(</span><span class="tok-nv">type</span><span class="tok-o">=</span>null, <span class="tok-nv">customKind</span><span class="tok-o">=</span>true, <span class="tok-nv">name</span><span class="tok-o">=</span>null, <span class="tok-nv">version</span><span class="tok-o">=</span>null, <span class="tok-nv">location</span><span class="tok-o">=</span>null, <span class="tok-nv">reference</span><span class="tok-o">=</span>null, <span class="tok-nv">metadata</span><span class="tok-o">={</span><span class="tok-nv">id</span><span class="tok-o">=</span>ca86ca54-6719-471e-b10e-fb4a6f20e85d<span class="tok-o">}</span>, <span class="tok-nv">artifactAccount</span><span class="tok-o">=</span>null, <span class="tok-nv">provenance</span><span class="tok-o">=</span>null, <span class="tok-nv">uuid</span><span class="tok-o">=</span>null<span class="tok-o">)</span>, <span class="tok-nv">id</span><span class="tok-o">=</span>0730e728-e19a-43af-b9e5-9856332e939d, <span class="tok-nv">boundArtifact</span><span class="tok-o">=</span>null<span class="tok-o">)</span> could not be resolved.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_the_address_of_our_artifacts">What is the "address" of our Artifacts?</h3>
<div class="ulist">
<ul>
<li>
<p>URI of the location of our artifact</p>
</li>
<li>
<p>Provenance information about the commit that triggered the resource</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Provenance <em>def:</em> - The place of origin or earliest known history of something
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_artifact_decoration">Artifact Decoration</h3>
<div class="ulist">
<ul>
<li>
<p>To allow more provenance information, a JSON is used to describe extras like:</p>
<div class="ulist">
<ul>
<li>
<p>name</p>
</li>
<li>
<p>version</p>
</li>
<li>
<p>location</p>
</li>
</ul>
</div>
</li>
<li>
<p>This is called <em>artifact decoration</em></p>
</li>
<li>
<p>Every Spinnaker artifact follows this specification whether:</p>
<div class="ulist">
<ul>
<li>
<p>Supplied to a pipeline</p>
</li>
<li>
<p>Accessed within a pipeline</p>
</li>
<li>
<p>Produced by a pipeline–follows</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_artifact_format">Artifact Format</h3>
<div class="paragraph">
<p>As an example, an object stored in Google Cloud Storage (GCS) might be accessed using the following Spinnaker artifact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;gcs/object&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;reference&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;gs://bucket/file.json#135028134000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;gs://bucket/file.json&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;135028134000&quot;</span>
  <span class="tok-s2">&quot;location&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;us-central1&quot;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;docker/image&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;reference&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;gcr.io/project/image@sha256:29fee8e284&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;gcr.io/project/image&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;sha256:29fee8e284&quot;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_spinnaker_artifact_fields">Spinnaker Artifact Fields</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Explanation</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How the external resource is classified. (This allows for easy distinction between Docker images and Debian packages, for example).</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reference</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URI used to fetch the resource.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>artifactAccount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Spinnaker artifact account that has permission to fetch the resource.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version of the resource. (By convention, version should only be compared between artifacts of the same type and name.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>provenance</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The relevant URI from the system that produced the resource. (This is used for deep-linking into other systems from Spinnaker.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbitrary key / value metadata pertaining to the resource. (This can be useful for scripting within pipeline stages.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The region, zone, or namespace of the resource. (This does not add information to the URI, but makes multi-regional deployments easier to configure.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uuid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used for tracing the artifact within Spinnaker.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assigned by Spinnaker.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_expected_artifacts">Expected Artifacts</h3>
<div class="ulist">
<ul>
<li>
<p>Expects a particular artifact to be available</p>
</li>
<li>
<p>Declarable within a pipeline trigger or stage</p>
</li>
<li>
<p>Spinnaker compares an incoming artifact (for example, a manifest file stored in GitHub) to the expected artifact (for example, a manifest with the file path <code>path/to/my/manifest.yml</code>)</p>
</li>
<li>
<p>If there is a match it is <em>bound</em> to that artifact and used</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_expected_and_bound_artifact">Expected and Bound Artifact</h3>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/reference/artifacts-with-artifactsrewrite/expected-artifact-github-file.png" alt="expected artifact github file">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_matched_artifacts">Matched Artifacts</h3>
<div class="ulist">
<ul>
<li>
<p>Used to disambiguate between similar artifacts coming from the same account</p>
<div class="ulist">
<ul>
<li>
<p>e.g. Different <code>yaml</code> files from the same repository</p>
</li>
</ul>
</div>
</li>
<li>
<p>Filter by fields in the artifact format against which to compare in the incoming artifact</p>
</li>
<li>
<p>Used to specify that the trigger should begin pipeline execution only if the incoming artifact matches the parameters that you provided</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prior_execution_and_default_artifacts">Prior execution and Default Artifacts</h3>
<div class="ulist">
<ul>
<li>
<p><strong>If Missing</strong></p>
<div class="ulist">
<ul>
<li>
<p>Provide fallback behavior for the expected artifact in case the trigger doesn&#8217;t find the desired artifact.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong> Use prior execution</strong></p>
<div class="ulist">
<ul>
<li>
<p>Spinnaker will fall back to the artifact used in the last execution.</p>
</li>
<li>
<p>If you enable the <strong>Use default artifact</strong> Spinnaker will use a default artifact,</p>
</li>
<li>
<p>Allows you to provide fallback behavior for the first time a trigger is used, when no previous execution exists</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/reference/artifacts/in-pipelines/pubsub-trigger-artifact.png" alt="pubsub trigger artifact">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_review_of_artifacts">Review of Artifacts</h3>
<div class="ulist">
<ul>
<li>
<p>Expected - An artifact that a trigger or stage expects to have</p>
</li>
<li>
<p>Bound - An artifact that has been fulfilled</p>
</li>
<li>
<p>Matched - Enter fields to disambiguate similar artifacts</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_artifacts_in_pipelines">Artifacts in Pipelines</h3>
<div class="paragraph">
<p>Defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An artifact arrives in a pipeline execution either from an external trigger (for example, a Docker image pushed to a registry)</p>
</li>
<li>
<p>Getting fetched by a stage. That artifact is then consumed by downstream stages based on predefined behavior.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Expected Artifacts</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable a stage to bind an artifact from:</p>
<div class="ulist">
<ul>
<li>
<p>Another pipeline execution</p>
</li>
<li>
<p>Stage output</p>
</li>
<li>
<p>Running environment</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_triggers">Triggers</h3>
<div class="paragraph">
<p>When configuring a pipeline trigger, you can declare which artifacts the trigger expects to have present before it begins a pipeline execution!</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/reference/artifacts/in-pipelines/expected-artifact-trigger.png" alt="expected artifact trigger">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_find_artifact_from_execution">Find Artifact from Execution</h3>
<div class="ulist">
<ul>
<li>
<p>To allow you to promote artifacts between executions, you can make use of the “Find Artifact from Execution” stage.</p>
</li>
<li>
<p>All that’s required is the pipeline ID whose execution history to search, and an expected artifact to bind.</p>
</li>
<li>
<p>This will be particularly useful for canary attainment of baseline</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/reference/artifacts/in-pipelines/find-artifact-from-execution.png" alt="find artifact from execution">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_artifacts_passed_between_pipelines">Artifacts Passed between Pipelines</h3>
<div class="ulist">
<ul>
<li>
<p>Artifacts can be passed between pipelines.</p>
</li>
<li>
<p>Two cases:</p>
<div class="ulist">
<ul>
<li>
<p>Pipeline B is triggered by Pipeline A - Pipeline B is triggered by Pipeline A, therefore Pipeline B will have Pipeline A&#8217;s artifacts</p>
</li>
<li>
<p>Pipeline A triggers Pipeline B - Pipeline A is triggers Pipeline B, therefore Pipeline B will have Pipeline A&#8217;s artifacts</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_stages_that_produce_artifacts">Stages that Produce Artifacts</h3>
<div class="paragraph">
<p>Stages can be configured to ‘Produce’ artifacts if they expose the following Stage configuration:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/reference/artifacts/in-pipelines/produced-artifact.png" alt="produced artifact">
</div>
</div>
<div class="paragraph">
<p>Two ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To bind artifacts injected into the stage context - If your stage emits artifacts (such as a “Deploy (Manifest)” stage) into the pipeline context, you can match against these artifacts for downstream stages to consume.</p>
</li>
<li>
<p>To artificially inject artifacts into the stage context - If you are running a stage that does not natively emit artifacts (such as the “Run Job” stage), you can use the default artifact, which always binds to the expected artifact, to be injected into the pipeline each time it is run. Keep in mind: If the matching artifact is empty, it will bind any artifact, and your default artifact will not be used.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are configuring your stages using JSON, the expected artifacts are placed in a top-level <code>expectedArtifacts: []</code> list.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_various_types_of_artifacts">Various Types of Artifacts</h3>
<div class="paragraph">
<p>There are various types of artifacts or you can define your own:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Docker Image</p>
</li>
<li>
<p>Embedded Base64</p>
</li>
<li>
<p>GCS Object</p>
</li>
<li>
<p>S3 Object</p>
</li>
<li>
<p>Git Repo</p>
</li>
<li>
<p>GitHub File</p>
</li>
<li>
<p>GitLab File</p>
</li>
<li>
<p>Bitbucket File</p>
</li>
<li>
<p>HTTP File</p>
</li>
<li>
<p>Kubernetes Object</p>
</li>
<li>
<p>Oracle Object</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Source: <a href="https://www.spinnaker.io/reference/artifacts/types/overview" class="bare">https://www.spinnaker.io/reference/artifacts/types/overview</a></p>
</div>
<div class="sect3">
<h4 id="_sources">Sources</h4>
<div class="paragraph">
<p><a href="https://www.spinnaker.io/reference/artifacts-with-artifactsrewrite/" class="bare">https://www.spinnaker.io/reference/artifacts-with-artifactsrewrite/</a>
<a href="https://www.spinnaker.io/reference/artifacts-with-artifactsrewrite/in-kubernetes-v2/" class="bare">https://www.spinnaker.io/reference/artifacts-with-artifactsrewrite/in-kubernetes-v2/</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_linking_spinnaker_to_github">Linking Spinnaker to Github</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>In order to connect to github, we will need to establish a token</p>
</li>
<li>
<p>This will build a connection from Spinnaker to Github</p>
</li>
<li>
<p>As users you will create the token</p>
</li>
<li>
<p>As administration you will put the token in Spinnaker using Halyard</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_creating_a_token">Creating a token</h3>
<div class="ulist">
<ul>
<li>
<p>Visit your github account at: <a href="https://github.com/settings/tokens" class="bare">https://github.com/settings/tokens</a></p>
</li>
<li>
<p>Click on the <strong>Generate new token</strong> button</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/github-token.png" alt="github token">
</div>
<div class="title">Figure 3. Token Page</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the <code>public_repo</code> scope</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/github_access.png" alt="github access">
</div>
<div class="title">Figure 4. Allowing Use</div>
</div>
</div>
<div class="sect2">
<h3 id="_copying_the_token">Copying the token</h3>
<div class="ulist">
<ul>
<li>
<p>You have one shot to copy the token and secure it</p>
</li>
<li>
<p>Copy it, by clicking on the clipboard icon next to the hash</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/github_hash.png" alt="github hash">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_the_token_in_spinnaker">Setting up the token in Spinnaker</h3>
<div class="paragraph">
<p>Paste the token and store it in a temporary file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>pbpaste &gt; token_file.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Setup some temporary fields for both the location of token file, and the github account name</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span><span class="tok-nv">TOKEN_FILE</span><span class="tok-o">=</span>~/token_file.txt
<span class="tok-nv">ARTIFACT_ACCOUNT_NAME</span><span class="tok-o">=</span>&lt;github-username&gt;-account</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_your_github_connection">Installing your Github connection</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config features edit --artifacts <span class="tok-nb">true</span>
hal config artifact github <span class="tok-nb">enable</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add your account:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config artifact github account add <span class="tok-nv">$ARTIFACT_ACCOUNT_NAME</span> <span class="tok-se">\</span>
    --token-file <span class="tok-nv">$TOKEN_FILE</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_to_spinnaker">Deploy to Spinnaker</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal deploy apply</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_deploying_eks_microservices">Lab: Deploying EKS Microservices</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_preliminary">Preliminary</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Please work in a group</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>We will be running a lot of instances</p>
</li>
<li>
<p>Dev-ops is maddening</p>
</li>
</ol>
</div>
</li>
<li>
<p>We will let a fun service decide your teamname: <a href="http://creativityforyou.com/combomaker.html" class="bare">http://creativityforyou.com/combomaker.html</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_the_instructor_is_your_administrator">The instructor is your administrator!</h3>
<div class="paragraph">
<p>Your instructor will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an ECR repository</p>
</li>
<li>
<p>Create a github connection using a token</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_forking_a_repository">Forking A Repository</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Fork the repository <a href="https://github.com/dhinojosa/quarkus-microservice" class="bare">https://github.com/dhinojosa/quarkus-microservice</a> into your own public github account.</p>
</li>
<li>
<p>Notice the <code>manifests/deploy-microservice.yaml</code> file, and see the Deployment, and the Service</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
We will have one of you set up a token in your github repository, which will provide access to the spinnaker server, please delete at the end of class.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_editing_your_manifest">Editing your manifest</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your personal fork, edit your <code>manifest/deploy-microservice.yml</code></p>
</li>
<li>
<p>Perform a <em>replace all</em> in the document and replace <code>quarkus-microservice</code> with <code>&lt;your-team-name&gt;-microservice</code></p>
</li>
<li>
<p>Save file, commit, and push your file in your repository</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_a_jenkins_job">Setting up a Jenkins job</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open Jenkins at <a href="http://44.230.82.221:8080/" class="bare">http://44.230.82.221:8080/</a> and login with the username <strong>spinnaker</strong> and password <strong>timeisluxury</strong></p>
</li>
<li>
<p>Click on <strong>New Item</strong>, and a <strong>Pipeline Job</strong> in Jenkins</p>
</li>
<li>
<p>Name your job <strong>&lt;your-team-name&gt;-microservice</strong>, and click <strong>Ok</strong></p>
</li>
<li>
<p>Under <strong>Build Triggers</strong>, select <strong>Poll SCM</strong>, and in the text area enter <code>* * * * *</code></p>
</li>
<li>
<p>Under <strong>Pipeline</strong>, change <strong>Definition</strong> to <strong>Pipeline Script from SCM</strong></p>
</li>
<li>
<p>Change <strong>SCM</strong> to <code>Git</code>, and enter your repository URL that you cloned for your team</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/jenkins-pipeline.png" alt="jenkins pipeline">
</div>
<div class="title">Figure 5. Selecting <code>Jenkinsfile</code> that is stored already on the repository</div>
</div>
<hr>
<div class="imageblock">
<div class="content">
<img src="./images/jenkins-scm.png" alt="jenkins scm">
</div>
<div class="title">Figure 6. Selecting the Repository itself.</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_a_spinnaker_application">Setting up a Spinnaker Application</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open Spinnaker at address given by instructor, this is not secure so don&#8217;t place any personal information:</p>
</li>
<li>
<p>Once there create an Application with the name: <strong>&lt;your-team-name&gt;-microservice</strong></p>
</li>
<li>
<p>Add an email</p>
</li>
<li>
<p>In Repo Type add <code>github</code></p>
</li>
<li>
<p>In Description, add a description of your choosing</p>
</li>
<li>
<p>Create an instance port of <code>80</code></p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/create_application.png" alt="create application" width="50%" height="50%">
</div>
<div class="title">Figure 7. Creating a Spinnaker Application</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_pipeline">Creating a Pipeline</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on Pipelines, and click on "Configure a new pipeline"</p>
</li>
<li>
<p>Under <strong>Pipeline Name</strong>, name it "ToStaging"</p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/pipelines-icon.png" alt="pipelines icon">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_github_expected_artifact">Github Expected Artifact</h3>
<div class="paragraph">
<p>We will require two artifacts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Deployment <code>yaml</code> from Github</p>
</li>
<li>
<p>The Docker Container from ECR</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_the_github_expected_artifact">Setting up the Github Expected Artifact</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In <strong>Configuration</strong> under the <strong>Expect Artifacts</strong> section, click on <strong>Add Artifact</strong></p>
</li>
<li>
<p>In <strong>Account</strong> field, choose your <code>github</code> account</p>
</li>
<li>
<p>In <strong>File Path</strong>, enter <code>manifests/deploy-microservice.yaml</code>, remember where you saw this entry</p>
</li>
<li>
<p>In <strong>Display Name</strong>, enter 'deploy-microservice.yaml'</p>
</li>
<li>
<p>Check <strong>Use Default Artifact</strong></p>
</li>
<li>
<p>Select your determined <code>github</code> account</p>
</li>
<li>
<p>Enter in your content url and keep in mind this is a different kind of url:
<code><a href="https://api.github.com/repos/$ORG/$REPO/contents/$FILEPATH" class="bare">https://api.github.com/repos/$ORG/$REPO/contents/$FILEPATH</a></code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For Example:
   <code><a href="https://api.github.com/repos/dhinojosa/quarkus-microservice/contents/manifests/deploy-microservice.yml" class="bare">https://api.github.com/repos/dhinojosa/quarkus-microservice/contents/manifests/deploy-microservice.yml</a></code></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In <strong>Commit/Branch</strong> enter <code>master</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_docker_registry_artifact">Docker Registry Artifact</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In <strong>Configuration</strong> under the <strong>Add Artifacts</strong> section, click on <strong>Add Artifact</strong></p>
</li>
<li>
<p>In <strong>Account</strong>, choose <strong>Docker Registry</strong> Account</p>
</li>
<li>
<p>In <strong>Docker Image</strong>, add <code>219099013464.dkr.ecr.us-west-2.amazonaws.com/</code> followed by your &lt;team-name&gt;-microservice name. This will typically be your project name followed by <code>microservice</code>, ask the instructor to show what is on the ECR, or have them show you.</p>
</li>
<li>
<p>In <strong>Display Name</strong>, enter '<strong>&lt;your-team-name&gt;</strong>-microservice'</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/docker-registry.png" alt="docker registry">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If this doesn&#8217;t work, later we can add a default tag to the container
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_adding_a_docker_registry_container_trigger">Adding a Docker Registry Container Trigger</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In <strong>Automated Triggers</strong> section, click <strong>Add Trigger</strong></p>
</li>
<li>
<p>In the <strong>Type</strong> drop-down field, select <strong>Docker Registry</strong></p>
</li>
<li>
<p>In the <strong>Registry Name</strong> field, select <code>my-ecr-registry</code></p>
</li>
<li>
<p>In the <strong>Image</strong> field, select your image</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/docker-registry-trigger.png" alt="docker registry trigger">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your image name does not show, ask the administrator to add that to ECR
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_adding_a_notification">Adding a Notification</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Notifications</strong> Section, click <strong>Add Notification Preference</strong>, this will produce a dialog box</p>
</li>
<li>
<p>In the <strong>Notify Via</strong>, select <code>Email</code></p>
</li>
<li>
<p>In the <strong>Email Address</strong>, enter your email address</p>
</li>
<li>
<p>Select all the boxes for all notification</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This will get annoying over time, turn it off if needed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_save_changes">Save Changes</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the Save Changes Button</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/save-changes.png" alt="save changes">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_a_deploy_stage">Adding a Deploy Stage</h3>
<div class="imageblock">
<div class="content">
<img src="./images/spin-pipeline.png" alt="spin pipeline">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your pipeline, click on the <strong>Add Stage</strong> button</p>
</li>
<li>
<p>In the <strong>Type</strong> field, select <strong>Deploy (Manifest)</strong></p>
</li>
<li>
<p>This will present some new sections and fields</p>
</li>
<li>
<p>Go to the <strong>Deploy (Manifest) Configuration</strong> and <strong>Basic Settings</strong> section, in <strong>Account</strong> select <code>eks-stage</code></p>
</li>
<li>
<p>In the <strong>Manifest Configuration</strong> section, and for the <strong>Manifest Source</strong>, select <strong>Artifact</strong></p>
</li>
<li>
<p>In the <strong>Manifest Artifact</strong> select your <code>deploy-microservice.yaml</code> file</p>
</li>
<li>
<p>In the <strong>Required Artifacts to Bind</strong> select your container artifact binding</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/deploy-manifest.png" alt="deploy manifest">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploying_to_staging">Deploying to Staging</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on the pipelines icon <span class="image"><img src="./images/pipelines-icon.png" alt="pipelines icon" width="20%" height="20%"></span></p>
</li>
<li>
<p>Click on <strong>Start Manual Execution</strong></p>
</li>
<li>
<p>Check Results</p>
</li>
<li>
<p>If it doesn&#8217;t work, check configurations</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/pipeline-menu.png" alt="pipeline menu">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploying_to_production">Deploying to Production</h3>

</div>
<div class="sect2">
<h3 id="_creating_a_pipeline_2">Creating a Pipeline</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on Pipelines, and click on "Configure a new pipeline"</p>
</li>
<li>
<p>Under <strong>Pipeline Name</strong>, name it "ToProd"</p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/pipelines-icon.png" alt="pipelines icon">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_production_trigger">Production Trigger</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the new Pipeline Configuration, go to <strong>Automatic Triggers</strong></p>
</li>
<li>
<p>In the <strong>Type</strong> field select <strong>Pipeline</strong></p>
</li>
<li>
<p>In the <strong>Application</strong> field select your Application name (e.g. teama-microservice)</p>
</li>
<li>
<p>In the <strong>Pipeline</strong> field select <strong>ToStaging</strong>, which was the pipeline that was created</p>
</li>
<li>
<p>In the <strong>Pipeline Status</strong> select <strong>Successful</strong></p>
</li>
<li>
<p>For <strong>Artifact Constraints</strong> add <code>deploy-microservice.yml</code> and <code>&lt;your-team-name&gt;-microservice-container</code></p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/prod_trigger.png" alt="prod trigger">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_a_deploy_to_prod_stage">Adding a Deploy to Prod Stage</h3>
<div class="imageblock">
<div class="content">
<img src="./images/deploy_prod_0.png" alt="deploy prod 0">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/deploy_prod_1.png" alt="deploy prod 1">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your pipeline, click on the <strong>Add Stage</strong> button</p>
</li>
<li>
<p>In the <strong>Type</strong> field, select <strong>Deploy (Manifest)</strong></p>
</li>
<li>
<p>This will present some new sections and fields</p>
</li>
<li>
<p>Go to the <strong>Deploy (Manifest) Configuration</strong> and <strong>Basic Settings</strong> section, in <strong>Account</strong> select <code>eks-prod</code></p>
</li>
<li>
<p>In the <strong>Manifest Configuration</strong> section, and for the <strong>Manifest Source</strong>, select <strong>Artifact</strong></p>
</li>
<li>
<p>In the <strong>Manifest Artifact</strong> select your <code>deploy-microservice.yml</code> file</p>
</li>
<li>
<p>In the <strong>Required Artifacts to Bind</strong> select your container artifact binding</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_put_it_all_in_motion">Put it all in motion</h3>
<div class="ulist">
<ul>
<li>
<p>Make a change in your repository</p>
</li>
<li>
<p>Commit and Push</p>
</li>
<li>
<p>Ensure that your pipeline works!</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_bonus_place_a_manual_approve_in_stage">Bonus: Place a manual approve in stage</h3>
<div class="paragraph">
<p>After you run initially and had time to play around</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go back to the "ToStaging" pipeline</p>
</li>
<li>
<p>Select the <strong>Deploy (Manifest)</strong> stage</p>
</li>
<li>
<p>Click the <strong>Add Stage</strong> button</p>
</li>
<li>
<p>Select <strong>Manual Judgement</strong></p>
</li>
<li>
<p>Add some descriptions in the <strong>Instructions</strong> field</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_discover_your_space">Discover your space</h3>
<div class="ulist">
<ul>
<li>
<p>Ask the instructor for the ip address for your application</p>
</li>
<li>
<p>Edit the <code>index.html</code> in the <code>src/main/resources/META-INF.resources/</code> folder</p>
</li>
<li>
<p>Change the color, change the text</p>
</li>
<li>
<p>Perform a <code>git push</code> and see the results</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_things_to_discuss">Things to discuss</h3>
<div class="ulist">
<ul>
<li>
<p>How do the yaml files work</p>
</li>
<li>
<p>Ask the instructor to show the results on their <code>kubectl</code></p>
</li>
<li>
<p>What bad things happened?</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stop.png" alt="stop" width="20%" height="20%">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_expressions">Expressions</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Dynamically set and access variables during pipeline execution</p>
</li>
<li>
<p>Any text field can use an expression</p>
</li>
<li>
<p>Use them to:</p>
<div class="ulist">
<ul>
<li>
<p>Use arbitrary values about the state of your system in the execution of your pipelines.</p>
</li>
<li>
<p>Turn on or off particular stages or branches of your pipeline</p>
</li>
<li>
<p>Dynamically name your stack</p>
</li>
<li>
<p>Check the status of another stage</p>
</li>
<li>
<p>Perform other operations.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_what_are_expressions">What are expressions?</h3>
<div class="paragraph">
<p>A pipeline expression is made up of $ followed by opening/closing brackets: <code>${ }</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span><span class="tok-si">${</span><span class="tok-nv">expression</span><span class="tok-p"> here</span><span class="tok-si">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_string_interpolation">String interpolation</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span> <span class="tok-si">${</span><span class="tok-nv">expressionA</span><span class="tok-si">}</span>-randomString-<span class="tok-si">${</span><span class="tok-nv">expressionB</span><span class="tok-si">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Given "Hello" for <code>expressionA</code> and <code>world</code> for <code>expressionB</code>, this will result in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>Hello-randomString-world.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_where_can_expressions_be_used">Where can Expressions be used?</h3>
<div class="ulist">
<ul>
<li>
<p>Pipeline expressions any place in the UI where you can enter free-form text</p>
</li>
<li>
<p>Exception of the pipeline <strong>Configuration</strong> stage with exception of Expected Artifacts and "Use Default Artifact"</p>
</li>
<li>
<p>If text field is unavailable, there is a feature called <strong>Edit as JSON</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_when_are_they_evaluated">When are they evaluated</h3>
<div class="ulist">
<ul>
<li>
<p>Expressions are evaluated at the beginning of that stage</p>
</li>
<li>
<p><strong>Configuration</strong> needs to be evaluated <em>before</em> expression</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_helper_functions">Helper Functions</h3>
<div class="ulist">
<ul>
<li>
<p>Helper functions simplify common use cases</p>
<div class="ulist">
<ul>
<li>
<p>Access a particular stage by name</p>
</li>
<li>
<p>Strip non-alphanumerical characters</p>
</li>
<li>
<p>Parse JSON</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_finding_helper_functions">Finding Helper Functions</h3>
<div class="paragraph">
<p>Adding a pound sign (<code>#</code>) within your pipeline expression displays a list of all the helper functions that are available</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/expressions/images/helper-func-autocomplete.png" alt="helper func autocomplete">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_helper_properties">Helper Properties</h3>
<div class="paragraph">
<p>Helper properties are variables which refer to global information about the current pipeline execution.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>execution</code> - refers to the current pipeline execution</p>
</li>
<li>
<p><code>trigger</code> - information about the pipeline trigger</p>
<div class="ulist">
<ul>
<li>
<p>e.g. Jenkins trigger and want to know which build triggered the current pipeline</p>
</li>
<li>
<p><code>${trigger["buildInfo"]["number"]}</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_getting_help_with_helper_properties">Getting Help with Helper Properties</h3>
<div class="ulist">
<ul>
<li>
<p>List available helper properties and stages enter a question mark (<code>?</code>) into your pipeline expression</p>
</li>
<li>
<p>Type a little more of what you are looking for to narrow down your choices</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/expressions/images/helper-properties-list.png" alt="helper properties list">
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Once a helper property is added to the expression you can use any of the meta keys (Shift, Command, Alt, Control) to bring up a list of all the pipeline context that is relevant to the selected helper property.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_context_values">Context Values</h3>
<div class="ulist">
<ul>
<li>
<p><em>Context Values</em> are specific to a stage.</p>
</li>
<li>
<p>Includes:</p>
<div class="ulist">
<ul>
<li>
<p>Stage Name</p>
</li>
<li>
<p>Status</p>
</li>
<li>
<p>Start and End Time</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_finding_context_values">Finding Context Values</h3>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/expressions/images/execution-json.png" alt="execution json">
</div>
<div class="title">Figure 8. Click on the source link under the pipeline execution, which opens a new tab containing the JSON details of your pipeline execution.</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_pipeline_executions">Testing Pipeline Executions</h3>
<div class="ulist">
<ul>
<li>
<p>Testing is done through the API</p>
</li>
<li>
<p>You need a running instance of Spinnaker</p>
</li>
<li>
<p>Use <strong>Source</strong> of any stage and identify the pipeline execution</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/pipeline/expressions/images/execution-json.png" alt="execution json">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Then use <code>curl</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span><span class="tok-nv">PIPELINE_ID</span><span class="tok-o">=[</span>your_pipeline_id<span class="tok-o">]</span>
curl http://api.my.spinnaker/pipelines/<span class="tok-nv">$PIPELINE_ID</span>/evaluateExpression <span class="tok-se">\</span>
       -H <span class="tok-s2">&quot;Content-Type: text/plain&quot;</span> <span class="tok-se">\</span>
       --data <span class="tok-s1">&#39;${ #stage(&quot;Deploy&quot;).status.toString() }&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This then returns if successful</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span><span class="tok-o">{</span><span class="tok-s2">&quot;result&quot;</span>: <span class="tok-s2">&quot;SUCCEEDED&quot;</span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span><span class="tok-o">{</span>
  <span class="tok-s2">&quot;detail&quot;</span>:
    <span class="tok-o">{</span>
      <span class="tok-s2">&quot;{ #stage(\&quot;Deploy\&quot;).status.toString() &quot;</span>:
        <span class="tok-o">[</span>
          <span class="tok-o">{</span>
            <span class="tok-s2">&quot;description&quot;</span>:
              <span class="tok-s2">&quot;Failed to evaluate [expression] Expression</span>
<span class="tok-s2">              [{ #stage( #root.execution, \&quot;Deploy\&quot;).status.toString() ]</span>
<span class="tok-s2">              @0: No ending suffix &#39;}&#39; for expression starting at character 0:</span>
<span class="tok-s2">              { #stage( #root.execution, \&quot;Deploy\&quot;).status.toString() &quot;</span>,
            <span class="tok-s2">&quot;exceptionType&quot;</span>:<span class="tok-s2">&quot;org.springframework.expression.ParseException&quot;</span>,
            <span class="tok-s2">&quot;level&quot;</span>:<span class="tok-s2">&quot;ERROR&quot;</span>,
            <span class="tok-s2">&quot;timestamp&quot;</span>:1531254890849
         <span class="tok-o">}</span>
        <span class="tok-o">]</span>
   <span class="tok-o">}</span>,
  <span class="tok-s2">&quot;result&quot;</span>:<span class="tok-s2">&quot;</span><span class="tok-si">${#</span><span class="tok-nv">stage</span><span class="tok-p">(</span><span class="tok-se">\&quot;</span><span class="tok-nv">Deploy</span><span class="tok-se">\&quot;</span><span class="tok-p">).status.toString() </span><span class="tok-s2">&quot;</span>
<span class="tok-s2">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_baking">Baking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Baking turns templates into manifests with the help of a templating engine.
Helm relies on the <code>helm template</code> command.</p>
</div>
<div class="sect2">
<h3 id="_reminder_on_helm_templates">Reminder on Helm Templates</h3>
<div class="paragraph">
<p>We can take any <code>yaml</code> resource meant for Kubernetes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">v1</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ConfigMap</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">mychart-configmap</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">data</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">myvalue</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&quot;Hello</span><span class="tok-nv"> </span><span class="tok-s">World&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And templatize it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">v1</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ConfigMap</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-p tok-p-Indicator">{{</span> <span class="tok-nv">.Release.Name</span> <span class="tok-p tok-p-Indicator">}}</span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">-configmap</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">data</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">myvalue</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&quot;Hello</span><span class="tok-nv"> </span><span class="tok-s">World&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>{{ .Release.Name }}</code> will be replaced by the name of the release when the end user runs</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>helm install --debug --dry-run goodly-guppy ./mychart</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will return:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>apiVersion: v1
kind: ConfigMap
metadata:
  name: goodly-guppy-configmap
data:
  myvalue: <span class="tok-s2">&quot;Hello World&quot;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_helm_charts_offers_a_lot">Helm Charts offers a lot</h3>
<div class="ulist">
<ul>
<li>
<p>Values</p>
</li>
<li>
<p>Defaults</p>
</li>
<li>
<p>Template Functions and Pipelines</p>
</li>
<li>
<p>Flow Control</p>
</li>
<li>
<p>Variables</p>
</li>
<li>
<p>Embedded Templates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Read more: <a href="https://helm.sh/docs/chart_template_guide/getting_started/" class="bare">https://helm.sh/docs/chart_template_guide/getting_started/</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_intentions">Intentions</h3>
<div class="paragraph">
<p>This stage is intended to help you package and deploy applications that you own,
and are actively developing and redeploying frequently. It is not intended to
serve as a one-time installation method for third-party packages. If that
is your goal, it’s arguably better to call helm install once when
bootstrapping your Kubernetes cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configure_artifact_support_in_hal">Configure Artifact support in Hal</h3>
<div class="ulist">
<ul>
<li>
<p>Make sure that you have configured artifact support in Spinnaker first in Halyard</p>
</li>
<li>
<p>All Helm charts are fetched/stored as artifacts in Spinnaker</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_bake_manifest_stage">Create a Bake Manifest Stage</h3>
<div class="ulist">
<ul>
<li>
<p>Create a "Bake (Manifest)" stage</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/bake_manifest.png" alt="bake manifest" width="30%" height="30%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_the_bake_manifest_stage">Configure the Bake Manifest Stage</h3>
<div class="ulist">
<ul>
<li>
<p>Enter the release name (required) - The Helm release name for this chart. This determines the name of the artifact produced by this stage</p>
</li>
<li>
<p>The template artifact (required) - The Helm chart that you will be deploying, stored remotely as a <code>.tar.gz</code> archive</p>
</li>
<li>
<p>The release namespace - The Kubernetes namespace to install release into. If parameter is not specified default namespace will be used</p>
</li>
<li>
<p>Zero or more override artifacts (optional) - The files passed to <code>--values</code> parameter in the helm template command. Each is a remotely stored artifact representing a Helm Value File.</p>
</li>
<li>
<p>Statically specified overrides - The set of static of <code>key/value</code> pairs that are passed as <code>--set</code> parameters to the <code>helm template</code> command.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/bake_manifest_config_1.png" alt="bake manifest config 1" width="80%" height="80%">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/bake_manifest_config_2.png" alt="bake manifest config 2" width="80%" height="80%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_helm_charts_and_namespace">Helm Charts and Namespace</h3>
<div class="paragraph">
<p>Make sure you have <code>namespace</code> declaration in your helm chart if you are overriding the <code>namespace</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">namespace</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-p tok-p-Indicator">{{</span> <span class="tok-nv">.Release.Namespace</span> <span class="tok-p tok-p-Indicator">}}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_producing_baked_artifacts">Producing Baked Artifacts</h3>
<div class="paragraph">
<p>In the “Produces Artifacts” section:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Spinnaker has automatically created an <code>embedded/base64</code> artifact</p>
</li>
<li>
<p>The artifact is bound when the stage completes</p>
</li>
<li>
<p>Represents the fully baked manifest set to be deployed downstream</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/kubernetes-v2/deploy-helm/produces.png" alt="produces">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_downstream_deployment">Configure Downstream Deployment</h3>
<div class="paragraph">
<p>Now that the manifest set has been baked by Helm</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure a downstream stage (in the same pipeline or in one triggered by this pipeline)</p>
</li>
<li>
<p>Deploy the artifact produced by the “Bake (Manifest)” stage</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/kubernetes-v2/deploy-helm/expected-artifact.png" alt="expected artifact">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note: Make sure to select "embedded-artifact" as the artifact account for your <code>base64</code> manifest set.
This is required to translate the manifest set into the format required by the deploy stage.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_deploying_helm_microservices">Lab: Deploying Helm Microservices</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new Application, call it "&lt;your-team-name&gt;-baked"</p>
</li>
<li>
<p>Use the same repository</p>
</li>
<li>
<p>Create a new Pipeline called "ToStaging"</p>
</li>
<li>
<p>Disable your first project</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_configuration">Configuration</h3>
<div class="paragraph">
<p>In the <strong>Configuration</strong> Stage:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In <strong>Expected Artifacts</strong> click on <strong>Add Artifact</strong></p>
</li>
<li>
<p>Under <strong>Match Against</strong>, select <strong>my-s3-account</strong></p>
</li>
<li>
<p>Leave <strong>Object Path</strong> blank</p>
</li>
<li>
<p>For <strong>Display Name</strong>, enter <code>microservice-chart-tar-gz</code></p>
</li>
<li>
<p>Check <strong>Use Default Artifact</strong></p>
</li>
<li>
<p>In the <strong>Account</strong> field for the default artifact select <strong>my-s3-account</strong></p>
</li>
<li>
<p>In the <strong>Object Path</strong> enter: <code>s3://helm-charts-f2bba284-98d3-445b-9f04-a08c57b7d36e/${trigger['properties']['JOB_NAME']}/${trigger['properties']['BUILD_ID']}/quarkus-microservice-chart.tar.gz</code></p>
</li>
<li>
<p>Save</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ex2_expected_artifact_0.png" alt="ex2 expected artifact 0">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ex2_expected_artifact_1.png" alt="ex2 expected artifact 1">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bake_a_manifest">Bake a Manifest</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>While <strong>Configuration</strong> is highlighted, click <strong>Add Stage</strong></p>
</li>
<li>
<p>Select <strong>Bake Manifest</strong></p>
</li>
<li>
<p>In your new set of fields, for <strong>Render Engine</strong>, select <strong>HELM2</strong></p>
</li>
<li>
<p>For the name, enter your team name, do not put the word <code>microservice</code></p>
</li>
<li>
<p>For <strong>Expected Artifact</strong>, select the <code>microservice-chart-tar-gz</code> you created in the last step</p>
</li>
<li>
<p>In <strong>Overrides</strong>, enter new <strong>Key</strong> and <strong>Value</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>releaseType</code> key with a value of <code>staging</code></p>
</li>
<li>
<p><code>tag</code> key with a value of <code>${trigger['properties']['BUILD_ID']}</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ex2_helm_0.png" alt="ex2 helm 0">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ex2_helm_1.png" alt="ex2 helm 1">
</div>
</div>
<div class="sect3">
<h4 id="_producing_artifact">Producing Artifact</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Staying on the same stage, navigate down to <strong>Produces Artifacts</strong></p>
</li>
<li>
<p>In <strong>Match Against</strong> select kind as <strong>Base 64</strong></p>
</li>
<li>
<p>In the <strong>name</strong> field, enter your team name</p>
</li>
<li>
<p>In the <strong>Display Name</strong> in the next section enter <code>baked-&lt;teamname&gt;-microservice</code></p>
</li>
<li>
<p>Save</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/produce_artifact.png" alt="produce artifact">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_deploy_stage">Create a Deploy Stage</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>While the "Bake Manifest" Phase is selected, click <strong>Add Stage</strong></p>
</li>
<li>
<p>Select <strong>Deploy Manifest</strong></p>
</li>
<li>
<p>In <strong>Basic Settings</strong>, and in <strong>Account</strong>, select <code>eks-stage</code>, since we will deploy to stage</p>
</li>
<li>
<p>In <strong>Manifest Configuration</strong>, and in <strong>Manifest Source</strong>, select <strong>Artifact</strong></p>
</li>
<li>
<p>In <strong>Manifest Artifact</strong> select the Base64 object you created in the last step <code>baked-&lt;teamname&gt;-microservice</code></p>
</li>
<li>
<p>Save</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ex2_deploy_manifest.png" alt="ex2 deploy manifest">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_put_it_all_in_motion_2">Put it all in motion</h3>
<div class="ulist">
<ul>
<li>
<p>Make a change in your repository</p>
</li>
<li>
<p>Commit and Push</p>
</li>
<li>
<p>Ensure that your pipeline works!</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_things_to_discuss_2">Things to discuss</h3>
<div class="ulist">
<ul>
<li>
<p>Where did <strong>my-s3-account</strong> come from?</p>
</li>
<li>
<p>What was that funk that we typed into the <strong>Object Path</strong>?</p>
</li>
<li>
<p>What is the significance of to tar file?</p>
<div class="ulist">
<ul>
<li>
<p>How is it being stored?</p>
</li>
<li>
<p>Where do we get it?</p>
</li>
<li>
<p>How was it created?</p>
</li>
</ul>
</div>
</li>
<li>
<p>Base 64 why?</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stop.png" alt="stop" width="20%" height="20%">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rollbacks">Rollbacks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_automatic_rollbacks">Automatic Rollbacks</h3>
<div class="ulist">
<ul>
<li>
<p>Having manifests is optimal, IaC</p>
</li>
<li>
<p>Rollbacks though are necessary when things go wrong</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_viewing_the_rollbacks">Viewing the Rollbacks</h3>
<div class="ulist">
<ul>
<li>
<p>When using a Kubernetes <code>Deployment</code>, history of rollouts is in the <code>Clusters</code> tab of your Application</p>
</li>
<li>
<p>Spinnaker exposes “Undo Rollout” functionality in two places:</p>
<div class="ulist">
<ul>
<li>
<p>Clusters tab</p>
</li>
<li>
<p>Pipeline stage</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/kubernetes-v2/automated-rollbacks/revisions.png" alt="revisions">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ad_hoc_rollbacks">Ad Hoc Rollbacks</h3>
<div class="ulist">
<ul>
<li>
<p>In cases where you see something is immediately wrong and isolated to a resource in the “Clusters” tab</p>
</li>
<li>
<p>You can select “Undo Rollout” from the “Actions” dropdown</p>
</li>
<li>
<p>This provides an opportunity to select a healthier alternative</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/kubernetes-v2/automated-rollbacks/adhoc.png" alt="adhoc">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_automated_rollbacks">Automated Rollbacks</h3>
<div class="ulist">
<ul>
<li>
<p>You can also configure automated rollbacks inside of Spinnaker pipelines.</p>
</li>
<li>
<p>These stages are best configured to run when other stages or branches fail, indicating that something has gone wrong in your rollout.</p>
</li>
<li>
<p>Number of Revisions Back:</p>
<div class="ulist">
<ul>
<li>
<p>Counts how many revisions the current active revision should be rolled back by. If you have the following state:</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>nginx-deployment-2d8178b77 (Revision 5) # active
nginx-deployment-7bdd110f7 (Revision 4)
nginx-deployment-0b13cc8c1 (Revision 1)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And roll back by <code>“1”</code> revision, <code>(Revision 4)</code> will be active again. Roll back by <code>“2”</code> revisions and <code>(Revision 1)</code> will be active again.</p>
</div>
<div class="paragraph">
<p>Keep in mind that Kubernetes will implicitly roll-forward the old configuration, creating <code>(Revision 6)</code> in both cases.</p>
</div>
</div>
<div class="sect2">
<h3 id="_parameterized_rollbacks">Parameterized Rollbacks</h3>
<div class="ulist">
<ul>
<li>
<p>Parameterize the target resource to roll back</p>
</li>
<li>
<p>Reference anything via pipeline expressions</p>
</li>
<li>
<p>Point to something specified using pipeline parameters, for example:</p>
<div class="ulist">
<ul>
<li>
<p>Upstream deploy stage</p>
</li>
<li>
<p>Another stage’s outputs</p>
</li>
<li>
<p>Using pipeline expressions.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_versioning_artifacts">Versioning Artifacts</h3>
<div class="ulist">
<ul>
<li>
<p>Rolling Back will not work unless artifacts are versioned, this includes:</p>
<div class="ulist">
<ul>
<li>
<p>Docker images</p>
</li>
<li>
<p><code>ConfigMap</code></p>
</li>
<li>
<p>Kubernetes Secrets</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Source: <a href="https://blog.questionable.services/article/kubernetes-deployments-configmap-change/" class="bare">https://blog.questionable.services/article/kubernetes-deployments-configmap-change/</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scaling">Scaling</h2>
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_rollout_stratagies">Rollout Stratagies</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Deploys your containers as either:</p>
<div class="ulist">
<ul>
<li>
<p>Dark Rollouts</p>
</li>
<li>
<p>Highlander</p>
</li>
<li>
<p>Red/Black (also known as Blue/Green)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Is only valid for Kubernetes <code>ReplicaSet</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_configuration_options">Configuration Options</h3>
<div class="ulist">
<ul>
<li>
<p>Configuration options allow you to associate a workload with one or more services</p>
</li>
<li>
<p>Decide whether the workload should receive traffic, and determine how Spinnaker should handle any previous versions of the workload in the same cluster and <code>namespace</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/deployment_strategy.png" alt="deployment strategy">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Service namespace - Select the namespace containing the service(s) you would like to associate with the workload.</p>
</li>
<li>
<p>Service(s) - Select one or more services you would like to associate with the workload. Spinnaker will add a traffic.spinnaker.io/load-balancers annotation listing the selected services as described here.</p>
</li>
<li>
<p>Traffic - Check this box if you would like the workload to begin receiving traffic from the selected services as soon as it is ready. If you do not check this box, you can add a subsequent Enable (Manifest) stage to begin sending traffic to the workload.</p>
</li>
<li>
<p>Strategy - Select a strategy if you would like Spinnaker to handle previous versions of the workload currently deployed to the same cluster and namespace. Select None if you do not want Spinnaker to take any action regarding existing workloads.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_strategies">Strategies</h3>
<div class="sect3">
<h4 id="_dark_rollouts">Dark Rollouts</h4>
<div class="ulist">
<ul>
<li>
<p>Use a dark rollout to deploy a new version of your application alongside the existing version(s)</p>
</li>
<li>
<p>Does not immediately route any traffic to the new version.</p>
</li>
<li>
<p>Optionally, add subsequent Enable (Manifest) and Disable (Manifest) stage to begin sending traffic to the new version and stop sending traffic to the old version(s).</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/kubernetes-v2/rollout-strategies/dark.png" alt="dark">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_highlander">Highlander</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>"There can be only one"&#8201;&#8212;&#8201;Highlander (1986)</p>
</div>
</blockquote>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy a new version of your application alongside the existing version(s)</p>
</li>
<li>
<p>Send client traffic to the new version</p>
</li>
<li>
<p>Then disable and destroy existing versions in the cluster</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/kubernetes-v2/rollout-strategies/highlander.png" alt="highlander">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_redblack_bluegreen">Red/Black (Blue/Green)</h4>
<div class="ulist">
<ul>
<li>
<p>Red/black rollout to deploy a new version of your application alongside the existing version(s)</p>
</li>
<li>
<p>Send client traffic to the new version, and then disable existing versions in the cluster</p>
</li>
<li>
<p>Optionally, add subsequent Destroy (Manifest) stages to clean up any unwanted workloads in the cluster</p>
</li>
<li>
<p>Alternately, easily roll back to a previous version by:</p>
<div class="ulist">
<ul>
<li>
<p>Configuring an <strong>Enable (Manifest)</strong> stage</p>
</li>
<li>
<p>Or using an ad-hoc Enable operation from the Clusters tab.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/kubernetes-v2/rollout-strategies/redblack.png" alt="redblack">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_restrict_execution">Restrict Execution</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_execution_windows">Execution Windows</h3>
<div class="ulist">
<ul>
<li>
<p>Execution windows allow you to restrict the times of the day or week when deployments can happen.</p>
</li>
<li>
<p>By using execution windows, you can ensure that deployments don’t interfere with times where your service is at peak demand.</p>
</li>
<li>
<p>You can also use execution windows to make sure that there is always someone in the office ready to manually intervene or rollback your pipeline.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/execution_window.png" alt="execution window">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manual_judgement">Manual Judgement</h3>
<div class="paragraph">
<p>Manual Judgments serve as a gate for your pipeline
You can add manual judgement stages to interrupt the pipeline execution to run a manual check
This is great for teams that have a manual or out-of-band QA process</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on Configuration and select <strong>Add New Stage</strong></p>
</li>
<li>
<p>Enter “Please approve this pipeline” in the instructions</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/tutorials/codelabs/safe-deployments/images/manual1.png" alt="manual1">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_notifications_with_manual_judgment">Notifications with Manual Judgment</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on <strong>Add Notification Preference</strong></p>
</li>
<li>
<p>In the popup dialog:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select type Email</p>
</li>
<li>
<p>Enter your email address</p>
</li>
<li>
<p>Select to notify when <strong>This stage is awaiting judgment</strong>.</p>
</li>
<li>
<p>Click <strong>Update</strong></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/tutorials/codelabs/safe-deployments/images/manual2.png" alt="manual2">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_waiting_for_approval">Waiting for Approval</h3>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/tutorials/codelabs/safe-deployments/images/manual6.png" alt="manual6">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_changing_pipeline_on_selected_judgment">Changing Pipeline on Selected Judgment</h3>
<div class="paragraph">
<p>You can enter in your own choices and use SpEL to respond to the answers</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/tutorials/codelabs/safe-deployments/images/manual7.png" alt="manual7">
</div>
</div>
<div class="paragraph">
<p>Once applied you can create a subsequent stage that will conditionally trigger on your choice</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/tutorials/codelabs/safe-deployments/images/manual8.png" alt="manual8">
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_canary_deployment">Canary Deployment</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_it">What is it?</h3>
<div class="ulist">
<ul>
<li>
<p>Canary is a deployment process in which a change is partially rolled out then evaluated against the current deployment (baseline)</p>
</li>
<li>
<p>Ensure that the new deployment is operating at least as well as the old.</p>
</li>
<li>
<p>This evaluation is done using key metrics that are chosen when the canary is configured.</p>
</li>
<li>
<p>Microservices would need to expose some of their metrics</p>
</li>
<li>
<p>Canaries are usually run against deployments containing changes to code,
but they can also be used for operational changes, including changes to configuration.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisites">Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>Have metrics to evaluate</p>
<div class="ulist">
<ul>
<li>
<p>Provide metrics in your microservice application</p>
</li>
<li>
<p>Either deploy metrics or have it scraped</p>
</li>
<li>
<p>Support is built in for:</p>
<div class="ulist">
<ul>
<li>
<p>StackDriver</p>
</li>
<li>
<p>Datadog</p>
</li>
<li>
<p>Prometheus</p>
</li>
<li>
<p>SignalFx</p>
</li>
<li>
<p>NewRelic</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_process">Process</h3>
<div class="ulist">
<ul>
<li>
<p>Enable Canary</p>
</li>
<li>
<p>Create one or more canary configurations</p>
</li>
<li>
<p>Add one or more canary stages</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_enable_canary">Enable Canary</h3>
<div class="ulist">
<ul>
<li>
<p>Use Halyard</p>
</li>
<li>
<p>Setup <em>one</em> Metrics Service</p>
</li>
<li>
<p>Setup <em>one</em> a Storage Service</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_canary_analysis">Setting up Canary Analysis</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config canary <span class="tok-nb">enable</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_the_scope">Setting up the Scope</h3>
<div class="ulist">
<ul>
<li>
<p>Each configuration is visible to all canary pipeline stages</p>
</li>
<li>
<p>It can be configured so that it is only visible to the application where it was created</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config canary edit --show-all-configs-enabled <span class="tok-nb">false</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_the_canary_judge">Setting up the canary judge</h3>
<div class="ulist">
<ul>
<li>
<p>The current default judge is <code>NetflixACAJudge-v1.0</code></p>
</li>
<li>
<p>A judge accesses the quality of your deployment against the baseline</p>
</li>
<li>
<p>Each is compared to determine any degradation</p>
</li>
<li>
<p>Other judges are available and are pluggable</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config canary edit --default-judge JUDGE</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_identify_your_metrics_provider">Identify your metrics provider</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config canary edit --default-metrics-store STORE</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>STORE</code> can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>atlas</p>
</li>
<li>
<p>datadog</p>
</li>
<li>
<p>stackdriver</p>
</li>
<li>
<p>prometheus</p>
</li>
<li>
<p>newrelic</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_provide_a_default_metrics_account">Provide a default metrics account</h3>
<div class="ulist">
<ul>
<li>
<p>Add the account name to use for your metrics provider</p>
</li>
<li>
<p>Default can be overridden</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config canary edit --default-metrics-account ACCOUNT</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_provide_the_default_storage_account">Provide the default storage account</h3>
<div class="ulist">
<ul>
<li>
<p>Add the account name to use for your storage provider</p>
</li>
<li>
<p>Default can be overridden</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config canary edit --default-storage-account ACCOUNT</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_prometheus">Setting up Prometheus</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config canary prometheus <span class="tok-nb">enable</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manage_or_view_prometheus_account_for_canary">Manage or View Prometheus Account for Canary</h3>
<div class="paragraph">
<p>Add a Halyard/Spinnaker account to Prometheus</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config canary prometheus account add ACCOUNT --base-url</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit a Halyard/Spinnaker account to Prometheus</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>hal config canary prometheus account edit ACCOUNT --base-url</code></pre>
</div>
</div>
<div class="paragraph">
<p>Operations for <code>delete</code> and <code>list</code> are also available</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_canary_configuration">Create a Canary Configuration</h3>
<div class="ulist">
<ul>
<li>
<p>Canary configuration is done per <em>application</em></p>
</li>
<li>
<p>Each Application will have one or more configurations</p>
</li>
<li>
<p>Stages are defined separately</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_what_you_will_be_adding_into_a_canary_configuration">What you will be adding into a Canary Configuration</h3>
<div class="paragraph">
<p>You will be adding the following to your canary configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A name by which a canary stage can choose this configuration</p>
</li>
<li>
<p>The specific metrics to evaluate, and a logical grouping of those metrics</p>
</li>
<li>
<p>Default scoring thresholds (which can be overridden in the canary stage)</p>
</li>
<li>
<p>Optionally, one or more filter templates</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_canary_at_the_user_level">Enabling Canary at the User Level</h3>
<div class="ulist">
<ul>
<li>
<p>In the Application config, activate the Canary option</p>
</li>
<li>
<p>Do this separately for all applications that will use automated canary analysis</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/canary/config/enable_canary.png" alt="enable canary">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_your_canary_configuration">Create your Canary Configuration</h3>
<div class="ulist">
<ul>
<li>
<p>Configurations you create within an application are available to all pipelines in that application</p>
</li>
<li>
<p>Unless it is setup that all configurations are available to all applications</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_steps_for_canary_configuration_support">Steps for Canary Configuration Support</h3>
<div class="sect3">
<h4 id="_selecting_the_canary_configuration">Selecting the Canary Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Hover over the <strong>Delivery</strong> Tab, select Canary Configs</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/canary/config/delivery_menu_canary.png" alt="delivery menu canary">
</div>
</div>
<div class="paragraph">
<p>Select <strong>Add Configuration</strong></p>
</div>
<div class="paragraph">
<p>Provide a name and a description. The name is displayed when you show the canary stage on pipeline</p>
</div>
<div class="paragraph">
<p>Select your telemetry provider</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_metrics_group">Create Metrics Group</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create groups to determine weights</p>
</li>
<li>
<p>Click Group to create each group you&#8217;ll use. Select the group and click the edit icon</p>
</li>
<li>
<p>An example, would be "cpu" group to add a set of cpu metrics</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_metrics">Create Metrics</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Metrics</strong> section, add <strong>Metric</strong></p>
</li>
<li>
<p>Select the group to add this metric</p>
</li>
<li>
<p>Give the metric a name</p>
</li>
<li>
<p>Specify whether this metric fails when the value deviates too high or too low, or both compared to the baseline</p>
</li>
<li>
<p>Optionally, choose a filter template</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>resource.type = &quot;gce_instance&quot; AND
resource.labels.zone = starts_with(&quot;${zone}&quot;)</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Identify the metric you wish to include in this configuration</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/canary/config/metric_type_list_cpu.png" alt="metric type list cpu">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Optionally, if your providers, supports aggregation, you can click <strong>Group by</strong> and enter the metric metadata
For example, when you create a metric you can group its time series by resource or metric label. You can group a time series by zone, for example (<code>resource.zone</code>)</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you create a canary configuration, you create metric groups, and scoring thresholds and weights are applied to groups (rather than to specific metrics). But the grouping described in this step is for aggregating metrics before they’re returned to Kayenta.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click OK to save metric</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_add_filter_template">Add Filter Template</h4>
<div class="paragraph">
<p>If you are using <em>StackDriver</em> or <em>Prometheus</em> you can add filter templates then assign it to a metric</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Add Template</strong></p>
</li>
<li>
<p>Provide a Name - This is the name by which you can select it when configuring the specific metric.</p>
</li>
<li>
<p>In the Template field, enter an expression using the <em>FreeMarker</em> template language[<a href="https://freemarker.apache.org/docs/dgui_quickstart_template.html" class="bare">https://freemarker.apache.org/docs/dgui_quickstart_template.html</a>]</p>
</li>
<li>
<p>The expression is expanded using the variable bindings specified via the Extended Params in any canary stage that uses this configuration.</p>
</li>
<li>
<p>These variable bindings are also implicitly available: <code>project</code>, <code>resourceType</code>, <code>scope</code>, <code>location</code></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_editing_a_configuration">Editing a Configuration</h3>
<div class="ulist">
<ul>
<li>
<p>In <strong>Delivery</strong> tab select <strong>Canary Configs</strong></p>
</li>
<li>
<p>Select the configuration you would like to edit</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_adding_a_canary_stage">Adding a Canary Stage</h4>
<div class="sect4">
<h5 id="_about_canary_stages">About Canary Stages</h5>
<div class="ulist">
<ul>
<li>
<p>Canary analysis can be performed over data points collected beginning from the moment of execution and into the future, or it can be performed over a specified time interval.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_real_time_analysis">Real-time Analysis</h5>
<div class="paragraph">
<p>A real-time analysis means that the canary analysis is performed over a time interval beginning at the moment of execution.
The analysis happens for a specified time period, beginning when the stage executes (or after a specified Delay).
For Real Time, also specify the number of hours to run (Lifetime).</p>
</div>
</div>
<div class="sect4">
<h5 id="_retrospective_analysis">Retrospective Analysis</h5>
<div class="paragraph">
<p>In a retrospective analysis the canary analysis is performed over an explicitly specified time interval (likely in the past).
Analysis occurs over some specified period. Typically, this is done for a time period in the past, against a baseline deployment and a canary deployment which have already been running before this canary analysis stage starts.
Note that this analysis might analyze data for resources which no longer exist, for which there are still published time series.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_metric_scope">Metric Scope</h4>
<div class="paragraph">
<p>Metric scope defines:
* Where, when, and on what the canary analysis occurs.
* Specific baseline and canary server groups
* Start and end times and interval
* Cloud resource on which the baseline and canary are running</p>
</div>
</div>
<div class="sect3">
<h4 id="_defining_the_canary_stage">Defining the Canary Stage</h4>
<div class="ulist">
<ul>
<li>
<p>In your pipeline click on <strong>Add Stage</strong></p>
</li>
<li>
<p>For type, select <strong>Canary</strong></p>
</li>
<li>
<p>Give it the stage name and depends on field</p>
</li>
<li>
<p>In the analysis type select <strong>Real Time</strong> or <strong>Retrospective</strong></p>
</li>
<li>
<p>Choose a configuration name for the configuration you created before adding this stage</p>
</li>
<li>
<p>Set a delay: How many minutes to wait until warmed up</p>
</li>
<li>
<p>Set an interval: This is how frequently (in minutes) to capture and score the metrics.</p>
</li>
<li>
<p>Lookback Type: Growing or Slowing</p>
<div class="ulist">
<ul>
<li>
<p>In a growing analysis, a judgment is taken every [interval] minutes, but each judgment goes all the way back to the beginning of the Lifetime.</p>
</li>
<li>
<p>A sliding Lookback also makes a judgment every [interval], but each judgment only looks at the data from the most recent lookback duration. It would not be unusual for the Interval and the look-back duration to be the same, but they don’t have to be.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/canary/stage/stage_config_analysis.png" alt="stage config analysis">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Describe the metrics scope, Metric Scope has a magic wand next to the name that automatically resolve to available resources</p>
</li>
<li>
<p>Those resources are a starting point, which you can edit to match the specific resources you need.</p>
<div class="ulist">
<ul>
<li>
<p>Baseline - The server group to treat as the “control” in the canary analysis—that is, the deployment against which to compare the canary deployment.</p>
</li>
<li>
<p>Baseline Region - The region in which the baseline server group is deployed.</p>
</li>
<li>
<p>Canary - The server group to treat as the experiment in the analysis.</p>
</li>
<li>
<p>Canary Region - The region in which that canary server group is deployed.</p>
</li>
<li>
<p>Step - The interval, in seconds, for the metric time series.</p>
</li>
<li>
<p>Start Time and End Time (for retrospective) For a retrospective analysis, the specific time span over which to conduct the analysis.</p>
</li>
<li>
<p>Extended Params - Add any additional parameters, which are specific to the metric sources and which can be used to refine the scope of the analysis. These parameters can provide variable bindings for use in the expansion of custom filter templates specified in the canary config.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/canary/stage/metric_scope.png" alt="metric scope">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Adjust Scoring Thresholds is needed - The thresholds are pre-populated based on those configured in the main canary config, but you can override them here.</p>
</li>
<li>
<p>Specify the account that you are using for metrics and storage</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_judgement">Judgement</h4>
<div class="paragraph">
<p>Judgement goes through two phases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Data collection</p>
<div class="ulist">
<ul>
<li>
<p>Collect data from both baseline and canary deployments</p>
</li>
<li>
<p>Stored in a timeseries database</p>
</li>
<li>
<p>Include a set of tags or annotations that identify deployment</p>
</li>
</ul>
</div>
</li>
<li>
<p>Judgement</p>
<div class="ulist">
<ul>
<li>
<p>Compare the metrics from the data collection</p>
</li>
<li>
<p>Renders a pass or fail</p>
</li>
<li>
<p>Can be configured with a "marginal" decision</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_judgement_phases">Judgement Phases</h4>
<div class="paragraph">
<p>Step 1: Data Validation</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensures that there is data</p>
</li>
<li>
<p>If no data is found in either baseline or canary, it moves onto the next metric</p>
</li>
<li>
<p>Judge does not fail if there is no data, since some data it&#8217;s ok to have no data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Step 2: Data Cleaning</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Handling Missing Values</p>
</li>
<li>
<p>Impute values for missing values</p>
</li>
<li>
<p>Optionally, outliers can be removed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Step 3: Metric Comparison</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This is the step that compares the canary and baseline data for each included metric.</p>
</li>
<li>
<p>Classification indicating there is a significant difference between baseline and canary</p>
</li>
<li>
<p>Each metric is either <em>Pass</em>, <em>High</em>, or <em>Low</em></p>
</li>
<li>
<p>Uses nonparametric statistical test to check for a significant difference between the canary and baseline metrics</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Step 4: Check the score</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If 9 out of 10 is "Pass" it is classified as pass if specified in the root configuration</p>
</li>
<li>
<p>Default judge is biased for simplicity- easy to interpret and understand</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.spinnaker.io/guides/user/canary/judge/metric_classifications.png" alt="metric classifications">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prometheus">Prometheus</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Prometheus is just one of the available metrics packages that analyzes data from your microservice</p>
</li>
<li>
<p>There are various metrics packages to include in your microservice in a variety of languages</p>
</li>
<li>
<p>The metrics are "scraped" by prometheus and aggregated into reports</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://prometheus.io/assets/architecture.png" alt="architecture">
</div>
</div>
<div class="sect2">
<h3 id="_prometheus_setup_in_kubernetes">Prometheus setup in Kubernetes</h3>
<div class="ulist">
<ul>
<li>
<p>There are various utilities to get Prometheus up and running, and documentation is terrible</p>
</li>
<li>
<p>One of the easier ones, despite horrible documentation, is the Prometheus Operator on Helm(<a href="https://coreos.com/operators/prometheus/docs/latest/user-guides/getting-started.html" class="bare">https://coreos.com/operators/prometheus/docs/latest/user-guides/getting-started.html</a>)</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://miro.medium.com/max/3592/1*6KI8wlyWwLwPYgt_SP1CCA.png" alt="1*6KI8wlyWwLwPYgt SP1CCA">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setup_for_prometheus">Setup for Prometheus</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>helm install &lt;name&gt; stable/prometheus-operator</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Ensure that you are in the right context. For canary testing you would need to be in <code>staging</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_service_monitor">Create a Service Monitor</h3>
<div class="ulist">
<ul>
<li>
<p>By default, Prometheus is install in the <code>default</code> namespace</p>
</li>
<li>
<p><code>namespaceSelector</code> will look for metrics in other <code>namespaces</code></p>
</li>
<li>
<p>This <code>ServiceMonitor</code> needs to be deployed in the <code>default</code> namespace</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">monitoring.coreos.com/v1</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ServiceMonitor</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">labels</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">release</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">lasertag</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">teama-microservice-service-monitor</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">spec</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">endpoints</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">interval</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">30s</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">path</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">/metrics</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">port</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">web</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">namespaceSelector</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">matchNames</span><span class="tok-p tok-p-Indicator">:</span>
      <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">microservices</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">selector</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">matchLabels</span><span class="tok-p tok-p-Indicator">:</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">app</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">teama-microservice-service</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_nodeport_or_loadbalancer">Create a <code>NodePort</code> or <code>LoadBalancer</code></h3>
<div class="paragraph">
<p>Once established, deploy a <code>NodePort</code> or <code>LoadBalancer</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>apiVersion: v1
kind: Service
metadata:
  name: prometheus
spec:
  type: <span class="tok-o">(</span>NodePort <span class="tok-p">|</span> LoadBalancer<span class="tok-o">)</span>
  ports:
  - name: web
    nodePort: <span class="tok-m">30900</span>
    port: <span class="tok-m">9090</span>
    protocol: TCP
    targetPort: web
  selector:
    app: prometheus</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Choose <code>NodePort</code> or <code>LoadBalancer</code>,  <code>(NodePort | LoadBalancer)</code> is not a valid option
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_advanced_features">Lab: Advanced Features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_discovering_prometheus">Discovering Prometheus</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visit <a href="http://aba3fd2983dac11eab3c20a9ecbc5f37-1991264767.us-west-2.elb.amazonaws.com:9090/graph" class="bare">http://aba3fd2983dac11eab3c20a9ecbc5f37-1991264767.us-west-2.elb.amazonaws.com:9090/graph</a></p>
</li>
<li>
<p>In the dropdown that contains states <code>-insert metric at cursor</code> select <code>application_org_acme_metrics_PrimeNumberChecker_checksTimer_mean_seconds</code></p>
</li>
<li>
<p>Go to the source code and locate the <em>src/main/java/org/acme/metrics/PrimeNumberChecker.java</em> file</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Notice the annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@GET</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/{number}&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Counted</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;performedChecks&quot;</span><span class="tok-o">,</span>
         <span class="tok-n">description</span> <span class="tok-o">=</span> <span class="tok-s">&quot;How many primality checks have been performed.&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Timed</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;checksTimer&quot;</span><span class="tok-o">,</span>
       <span class="tok-n">description</span> <span class="tok-o">=</span> <span class="tok-s">&quot;A measure of how long it takes to perform the primality test.&quot;</span><span class="tok-o">,</span>
       <span class="tok-n">unit</span> <span class="tok-o">=</span> <span class="tok-n">MetricUnits</span><span class="tok-o">.</span><span class="tok-na">MILLISECONDS</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_view_the_metrics_of_your_microservice">View the metrics of your microservice</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the URL of your application, go to the <code>metrics</code> folder of your microservice</p>
</li>
<li>
<p>For example if your team name was teama, then go to: <code><a href="http://&lt;url&gt;/teama/metrics" class="bare">http://&lt;url&gt;/teama/metrics</a></code></p>
</li>
<li>
<p>Notice the results</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_create_an_application_2">Create an Application</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new Application, call it "&lt;your-team-name&gt;-canary"</p>
</li>
<li>
<p>Use the same repository</p>
</li>
<li>
<p>Create a new Pipeline called "ToStaging"</p>
</li>
<li>
<p>Disable your second project</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_create_canary_configs">Create Canary Configs</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on <strong>Delivery</strong>, and <strong>Canary Configs</strong></p>
</li>
<li>
<p>On the left, click on <strong>Add Configuration</strong></p>
</li>
<li>
<p>For the <strong>Configuration Name</strong>, call it <code>new-config</code></p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ex3_canary_config.png" alt="ex3 canary config">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_add_a_metric">Add a Metric</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Metrics</strong> section, select <strong>Group 1</strong>, and click on <strong>Add Metric</strong></p>
</li>
<li>
<p>In your dialog box,</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ex3_canary_config.png" alt="ex3 canary config">
</div>
<div class="title">Figure 9. Initial Canary Config</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ex3_canary_metrics.png" alt="ex3 canary metrics">
</div>
<div class="title">Figure 10. Adding a Metric</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_of_the_metric">Configuration of the Metric</h3>
<div class="ulist">
<ul>
<li>
<p>In the dialog box, in the <strong>Name</strong> field, enter <code>mean_seconds</code></p>
</li>
<li>
<p>In the <strong>Fail On</strong> field, select <strong>Increase</strong></p>
</li>
<li>
<p>For the <strong>NaN Strategy</strong>, leave the <strong>Default (remove)</strong></p>
</li>
<li>
<p>For the <strong>Query</strong> type, select <strong>Default</strong></p>
</li>
<li>
<p>For <strong>Metric Name</strong>, select <code>application_org_acme_metrics_PrimeNumberChecker_checksTimer_max_seconds</code></p>
</li>
<li>
<p>In <strong>Filter Template</strong>, select <strong>Create New</strong></p>
</li>
<li>
<p>For the new <strong>Filter Template</strong></p>
<div class="ulist">
<ul>
<li>
<p>Under the <strong>Name</strong> field enter <code>pod</code></p>
</li>
<li>
<p>For the <strong>Template</strong> enter <code>pod=~"${scope}.+"</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ex3_canary_metric_configure.png" alt="ex3 canary metric configure">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scoring">Scoring</h3>
<div class="paragraph">
<p>For Scoring, since we have one group, we will make that value <code>100</code></p>
</div>
<div class="paragraph">
<p>image::ex3_scoring.png</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_pipeline_3">Creating a Pipeline</h3>
<div class="ulist">
<ul>
<li>
<p>Create a new pipeline called "ToStaging"</p>
</li>
<li>
<p>Create one Trigger, for Jenkins</p>
<div class="ulist">
<ul>
<li>
<p>For <strong>Type</strong> select "Jenkins"</p>
</li>
<li>
<p>For <strong>Controller</strong> select "jenkins-master"</p>
</li>
<li>
<p>For <strong>Job</strong> select your job from Jenkins</p>
</li>
<li>
<p>In <strong>Property File</strong>, enter <code>spinnaker.properties</code></p>
</li>
<li>
<p>Ensure that the Trigger is enabled</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_create_deploy_manifest_stage">Create Deploy Manifest Stage</h3>
<div class="ulist">
<ul>
<li>
<p>Building off of <strong>Configuration</strong>, create a <code>Deploy (Manifest)</code> stage</p>
</li>
<li>
<p>For <strong>Stage Name</strong>, enter <code>Deploy Canary</code></p>
</li>
<li>
<p>In <strong>Basic Settings</strong>, for <strong>Account</strong>, enter <code>eks-stage</code></p>
</li>
<li>
<p>In the <strong>Manifest Source</strong></p>
<div class="ulist">
<ul>
<li>
<p>Select <strong>Text</strong></p>
</li>
<li>
<p>Enter the following manifest, replacing <code>your-team</code> with your team name</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apps/v1</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">Deployment</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">labels</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">app</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-canary</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">release</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">canary</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">source</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">demo</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">stack</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">frontend</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-canary</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">namespace</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">microservices</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">spec</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">replicas</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">3</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">selector</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">matchLabels</span><span class="tok-p tok-p-Indicator">:</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">run</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-canary</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">template</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">labels</span><span class="tok-p tok-p-Indicator">:</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">app</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-canary</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">release</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">canary</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">run</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-canary</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">source</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">demo</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">spec</span><span class="tok-p tok-p-Indicator">:</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">containers</span><span class="tok-p tok-p-Indicator">:</span>
        <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">image</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-p tok-p-Indicator">&gt;-</span>
            <span class="tok-no">219099013464.dkr.ecr.us-west-2.amazonaws.com/your-team-microservice:${trigger[&#39;properties&#39;][&#39;BUILD_ID&#39;]}</span>
          <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-canary</span>
          <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ports</span><span class="tok-p tok-p-Indicator">:</span>
            <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">containerPort</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">8080</span>
              <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">web</span>
<span class="tok-nn">---</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">v1</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">Service</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">labels</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">app</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-service-canary</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-service-canary</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">namespace</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">microservices</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">spec</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ports</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">web</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">port</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">30201</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">protocol</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">TCP</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">targetPort</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">8080</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">selector</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">app</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-canary</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">source</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">demo</span>
<span class="tok-nn">---</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">monitoring.coreos.com/v1</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ServiceMonitor</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">labels</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">release</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">lasertag</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-service-monitor-canary</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">spec</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">endpoints</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">interval</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">30s</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">path</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">/metrics</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">port</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">web</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">namespaceSelector</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">matchNames</span><span class="tok-p tok-p-Indicator">:</span>
      <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">microservices</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">selector</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">matchLabels</span><span class="tok-p tok-p-Indicator">:</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">app</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-service-canary</span>
<span class="tok-nn">---</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">networking.k8s.io/v1beta1</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">Ingress</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">annotations</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">nginx.ingress.kubernetes.io/rewrite-target</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">/$2</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-ingress-canary</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">namespace</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">microservices</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">spec</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">rules</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">http</span><span class="tok-p tok-p-Indicator">:</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">paths</span><span class="tok-p tok-p-Indicator">:</span>
          <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">backend</span><span class="tok-p tok-p-Indicator">:</span>
              <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">serviceName</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-service-canary</span>
              <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">servicePort</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">30201</span>
            <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">path</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">/your-team/canary(/|$)(.*)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_find_baseline">Find Baseline</h3>
<div class="ulist">
<ul>
<li>
<p>While Selecting <strong>Deploy Canary</strong>, click on <strong>Add Stage</strong></p>
</li>
<li>
<p>Select <code>Find Artifacts From Resource (Manifest)</code></p>
</li>
<li>
<p>For <strong>Stage Name</strong> enter <code>FindBaseline</code></p>
</li>
<li>
<p>In the <strong>Find Artifacts from Resource (Manifest) Configuration</strong></p>
<div class="ulist">
<ul>
<li>
<p>In <strong>Account</strong> enter <code>eks-prod</code></p>
</li>
<li>
<p>In <strong>Namespace</strong> enter <code>microservices</code></p>
</li>
<li>
<p>In <strong>Kind</strong> enter <code>deployment</code></p>
</li>
<li>
<p>For Selector select "Choose a static target"</p>
</li>
<li>
<p>For the <strong>Name</strong>, enter <code>&lt;team-name&gt;-microservice</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ex3_find_baseline.png" alt="ex3 find baseline">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_baseline">Deploy Baseline</h3>
<div class="ulist">
<ul>
<li>
<p>While Selecting <strong>FindBaseline</strong>, click on <strong>Add Stage</strong></p>
</li>
<li>
<p>Select <code>Deploy (Manifest)</code></p>
</li>
<li>
<p>For <strong>Stage Name</strong> enter <code>DeployBaseline</code></p>
</li>
<li>
<p>In <strong>Basic Settings</strong>, for <strong>Account</strong>, enter <code>eks-stage</code></p>
</li>
<li>
<p>In the <strong>Manifest Source</strong></p>
<div class="ulist">
<ul>
<li>
<p>Select <strong>Text</strong></p>
</li>
<li>
<p>Enter the following manifest, replacing <code>your-team</code> with your team name</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apps/v1</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">Deployment</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">labels</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">app</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-baseline</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">release</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">baseline</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">source</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">demo</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">stack</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">frontend</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-baseline</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">namespace</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">microservices</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">spec</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">replicas</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">3</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">selector</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">matchLabels</span><span class="tok-p tok-p-Indicator">:</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">run</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-baseline</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">template</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">labels</span><span class="tok-p tok-p-Indicator">:</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">app</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-baseline</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">release</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">baseline</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">run</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-baseline</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">source</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">demo</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">spec</span><span class="tok-p tok-p-Indicator">:</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">containers</span><span class="tok-p tok-p-Indicator">:</span>
        <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">image</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&#39;${#stage(</span><span class="tok-se">&#39;&#39;</span><span class="tok-s">FindBaseline</span><span class="tok-se">&#39;&#39;</span><span class="tok-s">).context[&quot;artifacts&quot;][0][&quot;reference&quot;]}&#39;</span>
          <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-baseline</span>
          <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ports</span><span class="tok-p tok-p-Indicator">:</span>
            <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">containerPort</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">8080</span>
              <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">web</span>
<span class="tok-nn">---</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">v1</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">Service</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">labels</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">app</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-service-baseline</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-service-baseline</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">namespace</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">microservices</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">spec</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ports</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">web</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">port</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">30201</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">protocol</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">TCP</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">targetPort</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">8080</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">selector</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">app</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-baseline</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">source</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">demo</span>
<span class="tok-nn">---</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">monitoring.coreos.com/v1</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ServiceMonitor</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">labels</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">release</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">lasertag</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-service-monitor-baseline</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">spec</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">endpoints</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">interval</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">30s</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">path</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">/metrics</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">port</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">web</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">namespaceSelector</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">matchNames</span><span class="tok-p tok-p-Indicator">:</span>
      <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">microservices</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">selector</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">matchLabels</span><span class="tok-p tok-p-Indicator">:</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">app</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-service-baseline</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">targetLabels</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">release app source</span>
<span class="tok-nn">---</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">networking.k8s.io/v1beta1</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">Ingress</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">annotations</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">nginx.ingress.kubernetes.io/rewrite-target</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">/$2</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-ingress-baseline</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">namespace</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">microservices</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">spec</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">rules</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">http</span><span class="tok-p tok-p-Indicator">:</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">paths</span><span class="tok-p tok-p-Indicator">:</span>
          <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">backend</span><span class="tok-p tok-p-Indicator">:</span>
              <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">serviceName</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">your-team-microservice-service-baseline</span>
              <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">servicePort</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">30201</span>
            <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">path</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">/your-team/baseline(/|$)(.*)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_perform_a_canary_analysis">Perform a Canary Analysis</h3>
<div class="ulist">
<ul>
<li>
<p>While Selecting <strong>DeployBaseline</strong>, click on <strong>Add Stage</strong></p>
</li>
<li>
<p>Select <code>Canary Analysis</code></p>
</li>
<li>
<p>For <strong>Stage Name</strong> enter or leave it as <code>Canary Analysis</code></p>
</li>
<li>
<p>In the <strong>Canary Analysis Configuration</strong> and <strong>Analysis Config</strong> section:</p>
<div class="ulist">
<ul>
<li>
<p>In <strong>Analysis Type</strong>, select <strong>Real Time (Manual)</strong></p>
</li>
<li>
<p>In <strong>Config Name</strong>, select the config you just created <code>new-config</code></p>
</li>
<li>
<p>In <strong>Lifetime</strong>, select 4 minutes</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ex3_analysis_config.png" alt="ex3 analysis config">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ex3_analysis_config_1.png" alt="ex3 analysis config 1">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_delete_tokens_from_github">Delete tokens from Github</h3>
<div class="paragraph">
<p>If you were the member of your team that was in charge of the github account, be sure to delete your token</p>
</div>
</div>
<div class="sect2">
<h3 id="_things_to_discuss_3">Things to discuss</h3>
<div class="ulist">
<ul>
<li>
<p>How was the information scraped?</p>
</li>
<li>
<p>How did spinnaker talk with prometheus</p>
</li>
<li>
<p>Is this too much work? What&#8217;s the payoff?</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stop.png" alt="stop" width="20%" height="20%">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Dev-ops is hard, requires a lot of knowledge in:</p>
<div class="ulist">
<ul>
<li>
<p>Command line programming</p>
</li>
<li>
<p>Kubernetes</p>
</li>
<li>
<p>Prometheus</p>
</li>
<li>
<p>Multiple Languages</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will need to be creative</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-01-28 07:17:25 -0800
</div>
</div>
<style>
pre.pygments .hll { background-color: #ffffcc }
pre.pygments  { background: #f0f0f0; }
pre.pygments .tok-c { color: #60a0b0; font-style: italic } /* Comment */
pre.pygments .tok-err { border: 1px solid #FF0000 } /* Error */
pre.pygments .tok-k { color: #007020; font-weight: bold } /* Keyword */
pre.pygments .tok-o { color: #666666 } /* Operator */
pre.pygments .tok-ch { color: #60a0b0; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #007020 } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #60a0b0; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
pre.pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gr { color: #FF0000 } /* Generic.Error */
pre.pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
pre.pygments .tok-go { color: #888888 } /* Generic.Output */
pre.pygments .tok-gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
pre.pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
pre.pygments .tok-kc { color: #007020; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #007020 } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #902000 } /* Keyword.Type */
pre.pygments .tok-m { color: #40a070 } /* Literal.Number */
pre.pygments .tok-s { color: #4070a0 } /* Literal.String */
pre.pygments .tok-na { color: #4070a0 } /* Name.Attribute */
pre.pygments .tok-nb { color: #007020 } /* Name.Builtin */
pre.pygments .tok-nc { color: #0e84b5; font-weight: bold } /* Name.Class */
pre.pygments .tok-no { color: #60add5 } /* Name.Constant */
pre.pygments .tok-nd { color: #555555; font-weight: bold } /* Name.Decorator */
pre.pygments .tok-ni { color: #d55537; font-weight: bold } /* Name.Entity */
pre.pygments .tok-ne { color: #007020 } /* Name.Exception */
pre.pygments .tok-nf { color: #06287e } /* Name.Function */
pre.pygments .tok-nl { color: #002070; font-weight: bold } /* Name.Label */
pre.pygments .tok-nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
pre.pygments .tok-nt { color: #062873; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #bb60d5 } /* Name.Variable */
pre.pygments .tok-ow { color: #007020; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
pre.pygments .tok-mb { color: #40a070 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #40a070 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #40a070 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #40a070 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #40a070 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #4070a0 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #4070a0 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #4070a0 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #4070a0 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #4070a0 } /* Literal.String.Double */
pre.pygments .tok-se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #4070a0 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #c65d09 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #235388 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #4070a0 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #517918 } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #007020 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #06287e } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #bb60d5 } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #bb60d5 } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #bb60d5 } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #bb60d5 } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #40a070 } /* Literal.Number.Integer.Long */
</style>
</body>
</html>